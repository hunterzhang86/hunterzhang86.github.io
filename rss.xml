<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>FFlow Blog</title>
        <link>https://blog.fflow.link/</link>
        <description>FFlow 的飞流协同平台的博客</description>
        <generator>Hugo 0.104.2 https://gohugo.io/</generator>
        
            <language>zh-CN</language>
        
        
            <managingEditor>hunterzhang86@gmail.com (fflow)</managingEditor>
        
        
            <webMaster>hunterzhang86@gmail.com (fflow)</webMaster>
        
        
            <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
        
        <lastBuildDate>Sat, 01 Oct 2022 15:55:03 &#43;0000</lastBuildDate>
        
            <atom:link rel="self" type="application/rss&#43;xml" href="https://blog.fflow.link/rss.xml" />
        
        
            <item>
                <title>Spring Security 配置 Remember Me</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/spring-security-remember-me/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/spring-security-remember-me/</guid>
                <pubDate>Sat, 01 Oct 2022 11:18:11 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h2 id=&#34;1概述&#34;&gt;&lt;strong&gt;1。概述&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;本教程将展示&lt;strong&gt;如何使用 Spring Security 在 Web 应用程序中启用和配置 Remember Me&lt;/strong&gt;。之前已经讨论过设置&lt;a href=&#34;https://blog.fflow.link/spring-security-login&#34; title=&#34;Spring Security Form Login&#34;&gt;安全和简单表单登录的 MVC 应用程序&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;该机制将能够&lt;strong&gt;跨多个会话识别用户&lt;/strong&gt;——首先要了解的是，&lt;code&gt;Remember Me&lt;/code&gt; 仅在会话超时后才会启动。默认情况下，用户在 30 分钟不活跃后会超时，但在 &lt;em&gt;web.xml&lt;/em&gt; 中&lt;a href=&#34;https://blog.fflow.link/servlet-session-timeout&#34; title=&#34;Java Session Timeout&#34;&gt;可以配置超时时间&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;注意：本教程重点介绍&lt;strong&gt;基于标准 cookie 的方法&lt;/strong&gt;。对于持久化方法，请查看 &lt;a href=&#34;https://blog.fflow.link/spring-security-persistent-remember-me&#34;&gt;Spring Security -- Persistent Remember Me&lt;/a&gt; 指南。&lt;/p&gt;
&lt;h2 id=&#34;2安全配置&#34;&gt;&lt;strong&gt;2。安全配置&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;让我们看看如何使用 Java 设置安全配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@Configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@EnableWebSecurity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SecSecurityConfig&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebSecurityConfigurerAdapter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Bean&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;authenticationManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AuthenticationManager&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;authenticationManagerBean&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;authenticationManagerBean&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;configureGlobal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AuthenticationManagerBuilder&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;inMemoryAuthentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withUser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;user1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{noop}user1Pass&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;USER&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withUser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;admin1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{noop}admin1Pass&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ADMIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HttpSecurity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;authorizeRequests&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;antMatchers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/anonymous*&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;anonymous&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;antMatchers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login*&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;permitAll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;anyRequest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;authenticated&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;formLogin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;loginPage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login.html&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;loginProcessingUrl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;failureUrl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login.html?error=true&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;deleteCookies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;JSESSIONID&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;rememberMe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;uniqueAndSecret&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;如您所见，&lt;strong&gt;使用 &lt;em&gt;rememberMe()&lt;/em&gt; 的基本配置&lt;/strong&gt;非常简单，同时通过附加选项保证可扩展性。 &lt;em&gt;&lt;strong&gt;key&lt;/strong&gt;&lt;/em&gt; 在这里很重要——它是整个应用程序的私有秘钥，将在生成令牌的内容时使用。&lt;/p&gt;
&lt;p&gt;此外，可以使用 &lt;em&gt;tokenValiditySeconds()&lt;/em&gt; 将 ** 令牌有效时间从默认的 2 周配置为** - 例如 - 一天：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rememberMe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;uniqueAndSecret&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;tokenValiditySeconds&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;86400&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我们还可以看看等价的 XML 配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;expressions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;intercept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/anonymous*&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;isAnonymous()&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;intercept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login*&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;permitAll&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;intercept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/**&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;isAuthenticated()&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;form&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;login&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;html&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;failure&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/login.html?error=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logout&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cookies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;JSESSIONID&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remember&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;me&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;uniqueAndSecret&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;authenticationManager&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;provider&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;user1&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{noop}user1Pass&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;authorities&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROLE_USER&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;admin1&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{noop}admin1Pass&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;authorities&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROLE_ADMIN&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;provider&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;3登录表格&#34;&gt;&lt;strong&gt;3。登录表格&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;登录表单类似于&lt;a href=&#34;https://blog.fflow.link/spring-security-login#login-form&#34; title=&#34;A basic Login Form&#34;&gt;我们用于表单登录的那个&lt;/a&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;head&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Login&lt;span class=&#34;nt&#34;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;f&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;action=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;login&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;method=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;table&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&lt;/span&gt;User:&lt;span class=&#34;nt&#34;&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&amp;lt;input&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;text&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;value=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&lt;/span&gt;Password:&lt;span class=&#34;nt&#34;&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&amp;lt;input&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;/&amp;gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&lt;/span&gt;Remember Me:&lt;span class=&#34;nt&#34;&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&amp;lt;input&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;checkbox&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;remember-me&amp;#34;&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;/&amp;gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;td&amp;gt;&amp;lt;input&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;submit&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;submit&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;value=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;submit&amp;#34;&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;/&amp;gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;注意新添加的 &lt;em&gt;checkbox&lt;/em&gt; 输入会映射到 &lt;em&gt;remember-me&lt;/em&gt;。这个添加的输入足以在&lt;code&gt;Remember Me&lt;/code&gt;激活的情况下登录。&lt;/p&gt;
&lt;p&gt;此默认路径也可以更改为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;rememberMe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;rememberMeParameter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;remember-me-new&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;4cookie&#34;&gt;&lt;strong&gt;4。Cookie&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;该机制将在用户登录时创建一个额外的 cookie——&amp;quot;remember-me&amp;quot; cookie。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Remember Me cookie&lt;/strong&gt; 包含以下数据：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;&lt;strong&gt;用户名&lt;/strong&gt;&lt;/em&gt; -- 标识登录的主体&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;strong&gt;expirationTime&lt;/strong&gt;&lt;/em&gt; -- 使 cookie 过期；默认为 2 周&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MD5 hash&lt;/strong&gt; -- 前 2 个值的 -- &lt;em&gt;username&lt;/em&gt; 和 &lt;em&gt;expirationTime&lt;/em&gt; ，加上 &lt;em&gt;password&lt;/em&gt; 和预定义的 &lt;em&gt;key&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里首先要注意的是 &lt;em&gt;username&lt;/em&gt; 和 &lt;em&gt;password&lt;/em&gt; 都是 cookie 的一部分——这意味着，如果其中任何一个被更改，cookie 将不再有效。此外，可以从 cookie 中读取 &lt;em&gt;username&lt;/em&gt;。&lt;/p&gt;
&lt;p&gt;此外，如果 Remember Me 的 cookie 被捕获，此机制可能会受到攻击。 &lt;strong&gt;cookie 将是有效且可用的&lt;/strong&gt;，直到它过期或更改凭据。&lt;/p&gt;
&lt;h2 id=&#34;5实际使用&#34;&gt;&lt;strong&gt;5。实际使用&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;要查看 Remember Me 机制的工作情况，您需要：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;登录时记得我活跃&lt;/li&gt;
&lt;li&gt;等待会话过期（或删除浏览器中的 &lt;em&gt;JSESSIONID&lt;/em&gt; cookie）&lt;/li&gt;
&lt;li&gt;刷新页面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果 Remember Me 已经失效，cookie 过期后用户应该被 &lt;strong&gt;redirected back to the login page&lt;/strong&gt; 。登录以后用户会在&lt;strong&gt;在新令牌/cookie 的帮助下保持登录状态&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&#34;6结论&#34;&gt;&lt;strong&gt;6。结论&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;本教程展示了如何在安全配置中设置和配置 Remember Me，并简要描述了记录在 cookie 的数据类型。&lt;/p&gt;
&lt;p&gt;具体实现可以在&lt;a href=&#34;https://github.com/eugenp/tutorials/tree/master/spring-security-modules/spring-security-web-mvc-custom&#34; title=&#34;Spring Security Custom MVC Project &#34;&gt;示例 Github 项目&lt;/a&gt; -- 这是一个基于 Eclipse 的项目，所以它应该很容易导入和运行。&lt;/p&gt;
&lt;p&gt;当项目在本地运行时，可以在 [localhost] 上访问 &lt;em&gt;login.html&lt;/em&gt;（http://localhost:8080/spring-security-mvc-custom/login.html &amp;quot;Access the project on localhost&amp;quot;）。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E6%89%8B%E5%86%8C/">手册</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>浅谈 Java GC</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-gc/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-gc/</guid>
                <pubDate>Sat, 01 Oct 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;对象生命周期&#34;&gt;对象生命周期&lt;/h1&gt;
&lt;h2 id=&#34;引用计数法&#34;&gt;引用计数法&lt;/h2&gt;
&lt;p&gt;无法解决循环引用的问题&lt;/p&gt;
&lt;h2 id=&#34;可达性分析算法&#34;&gt;可达性分析算法&lt;/h2&gt;
&lt;p&gt;从 GC Roots 看对象是否可达：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;虚拟机栈(栈中的本地变量表)中引用的对象&lt;/li&gt;
&lt;li&gt;本地方法栈中 JNI(即 Native 方法)引用的对象&lt;/li&gt;
&lt;li&gt;方法区中类静态属性的变量&lt;/li&gt;
&lt;li&gt;方法区中常量引用的变量&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;引用&#34;&gt;引用&lt;/h3&gt;
&lt;h4 id=&#34;强引用&#34;&gt;强引用&lt;/h4&gt;
&lt;p&gt;只要强引用存在就不会回收&lt;/p&gt;
&lt;h4 id=&#34;软引用&#34;&gt;软引用&lt;/h4&gt;
&lt;p&gt;只有内存不够才会回收
浏览器的后退按钮&lt;/p&gt;
&lt;h4 id=&#34;弱引用&#34;&gt;弱引用&lt;/h4&gt;
&lt;p&gt;不管内存够不够都会回收&lt;/p&gt;
&lt;h4 id=&#34;虚引用&#34;&gt;虚引用&lt;/h4&gt;
&lt;p&gt;作为回收对象时的通知
回收方法区&lt;/p&gt;
&lt;h4 id=&#34;废弃常量&#34;&gt;废弃常量&lt;/h4&gt;
&lt;h4 id=&#34;无用的类&#34;&gt;无用的类&lt;/h4&gt;
&lt;p&gt;大量反射、动态代理、CGLib 频繁自定义的 ClassLoader
需要有类的卸载功能
通过更换 ClassLoader 实现类的卸载&lt;/p&gt;
&lt;h1 id=&#34;垃圾回收算法&#34;&gt;垃圾回收算法&lt;/h1&gt;
&lt;h2 id=&#34;标记-清除算法&#34;&gt;标记-清除算法&lt;/h2&gt;
&lt;p&gt;效率和内存碎片的问题&lt;/p&gt;
&lt;h2 id=&#34;复制算法&#34;&gt;复制算法&lt;/h2&gt;
&lt;p&gt;分区复制回收
适用于对象存活率较低的场景(新生代)&lt;/p&gt;
&lt;h2 id=&#34;标记-整理算法&#34;&gt;标记-整理算法&lt;/h2&gt;
&lt;p&gt;标记 - 清除 - 整理
使用与对象存活率较高的场景(老生代)&lt;/p&gt;
&lt;h2 id=&#34;分代收集算法&#34;&gt;分代收集算法&lt;/h2&gt;
&lt;p&gt;根据对象存活周期分为几块&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;新生代
复制算法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;老生代
标记 - 清除算法
标记 - 整理算法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;垃圾收集器&#34;&gt;垃圾收集器&lt;/h1&gt;
&lt;h2 id=&#34;serial-收集器&#34;&gt;Serial 收集器&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;缺点
单线程处理，需要暂停其他所有线程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优点
简单&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;parnew-收集器&#34;&gt;ParNew 收集器&lt;/h2&gt;
&lt;p&gt;Serial 收集器的多线程实现&lt;/p&gt;
&lt;h2 id=&#34;serial-old-收集器&#34;&gt;Serial Old 收集器&lt;/h2&gt;
&lt;p&gt;Serial 收集器的老年代版本&lt;/p&gt;
&lt;h2 id=&#34;parallel-scavenge-收集器&#34;&gt;Parallel Scavenge 收集器&lt;/h2&gt;
&lt;p&gt;以&lt;code&gt;吞吐量&lt;/code&gt;为目标
吞吐量 = 用户代码运行时间 /(用户代码运行时间 + GC时间)&lt;/p&gt;
&lt;h2 id=&#34;parallel-old-收集器&#34;&gt;Parallel Old 收集器&lt;/h2&gt;
&lt;p&gt;Parallel Scavenge 收集器的老年代版本&lt;/p&gt;
&lt;h2 id=&#34;cms-收集器&#34;&gt;CMS 收集器&lt;/h2&gt;
&lt;p&gt;以获取最短停顿时间为目标
分为初始标记、并发标记、重新标记、并发清除四个阶段&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;优点
停顿时间短&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缺点
消耗较多的 CPU 资源
会产生较多的内存碎片 - [[CMS GC 为什么会产生内存碎片]]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为什么需要 STW？
处理起来简单，不用管并发的问题&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;g1-收集器&#34;&gt;G1 收集器&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;更少的 GC 停顿时间&lt;/li&gt;
&lt;li&gt;可预测的 GC 停顿时间&lt;/li&gt;
&lt;li&gt;不牺牲过多的吞吐量&lt;/li&gt;
&lt;li&gt;不需要过多的堆内存&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;zgc&#34;&gt;ZGC&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;低延迟&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/java/">Java</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/gc/">GC</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Spring Cloud Consul 入门指引</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/spring-cloud-consul/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/spring-cloud-consul/</guid>
                <pubDate>Fri, 30 Sep 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h2 id=&#34;1-概述&#34;&gt;&lt;strong&gt;1 概述&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.spring.io/spring-cloud-consul/&#34;&gt;Spring Cloud Consul&lt;/a&gt; 项目为 Spring Boot 应用程序提供了与 Consul 的轻松集成。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.consul.io/intro/&#34;&gt;Consul&lt;/a&gt; 是一个工具，它提供组件来解决微服务架构中一些最常见的挑战：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务发现——自动注册和注销服务实例的网络位置&lt;/li&gt;
&lt;li&gt;健康检查——检测服务实例何时启动并运行&lt;/li&gt;
&lt;li&gt;分布式配置——确保所有服务实例使用相同的配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在本文中，我们将了解如何配置 Spring Boot 应用程序以使用这些功能。&lt;/p&gt;
&lt;h2 id=&#34;2-前提条件&#34;&gt;&lt;strong&gt;2 前提条件&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;首先，建议快速浏览 &lt;a href=&#34;https://www.consul.io/intro/&#34;&gt;Consul&lt;/a&gt; 及其所有功能。&lt;/p&gt;
&lt;p&gt;在本文中，我们将使用在 &lt;em&gt;localhost:8500&lt;/em&gt; 上运行的 Consul 代理。有关如何安装 Consul 和运行代理的更多详细信息，请参阅此 &lt;a href=&#34;https://learn.hashicorp.com/tutorials/consul/get-started-install&#34;&gt;链接&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;首先，我们需要添加 [spring-cloud-starter-consul-all](&lt;a href=&#34;https://search.maven.org/classic/#search%7Cga%7C1%7Ca%3A%22spring-cloud-starter-&#34;&gt;https://search.maven.org/classic/#search%7Cga%7C1%7Ca%3A%22spring-cloud-starter-&lt;/a&gt; consul-all%22) 的 &lt;em&gt;pom.xml&lt;/em&gt; 的依赖：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-consul-all&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.1.1&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;3-服务发现&#34;&gt;&lt;strong&gt;3 服务发现&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;让我们编写我们的第一个 Spring Boot 应用程序并连接正在运行的 Consul 代理：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@SpringBootApplication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ServiceDiscoveryApplication&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SpringApplicationBuilder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServiceDiscoveryApplication&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;默认情况下，Spring Boot 将尝试连接到 &lt;em&gt;localhost:8500&lt;/em&gt; 的 Consul 代理。&lt;/strong&gt; 要使用其他设置，我们需要更新 &lt;em&gt;application.yml&lt;/em&gt; 文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  cloud:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    consul:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      host: localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: 8500
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然后，如果我们在浏览器中访问 Consul 代理的站点 &lt;em&gt;http://localhost:8500&lt;/em&gt; ，我们将看到我们的应用程序已在 Consul 中正确注册，标识符来自 &lt;em&gt;&amp;quot;${spring.application.name}： ${用逗号分隔的配置文件}:${server.port}&amp;quot;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;要自定义此标识符，我们需要使用另一个表达式更新属性 &lt;em&gt;spring.cloud.discovery.instanceId&lt;/em&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  application:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name: myApp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  cloud:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    consul:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      discovery:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        instanceId: ${spring.application.name}:${random.value}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;如果我们再次运行该应用程序，我们将看到它是使用标识符 &lt;em&gt;&amp;quot;MyApp&amp;quot;&lt;/em&gt; 加上一个随机值注册的。我们需要它来在本地机器上运行应用程序的多个实例。&lt;/p&gt;
&lt;p&gt;最后，&lt;strong&gt;要禁用服务发现，我们需要将属性 &lt;em&gt;spring.cloud.consul.discovery.enabled&lt;/em&gt; 设置为 &lt;em&gt;false&lt;/em&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;31-查找服务&#34;&gt;&lt;strong&gt;3.1 查找服务&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;我们已经在 Consul 中注册了我们的应用程序，但是客户端如何找到服务端点？我们需要一个发现客户端服务来从 Consul 获得正在运行且可用的服务。&lt;/p&gt;
&lt;p&gt;**Spring 为此提供了一个 &lt;em&gt;DiscoveryClient API&lt;/em&gt; **，我们可以使用 &lt;em&gt;@EnableDiscoveryClient&lt;/em&gt; 注释来启用它：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@SpringBootApplication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@EnableDiscoveryClient&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DiscoveryClientApplication&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然后，我们可以将 &lt;em&gt;DiscoveryClient&lt;/em&gt; bean 注入我们的控制器并访问实例：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@RestController&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DiscoveryClientController&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DiscoveryClient&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;discoveryClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Optional&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serviceUrl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;discoveryClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInstances&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;myApp&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;findFirst&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;si&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;si&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getUri&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;最后，我们将定义我们的应用程序端点：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@GetMapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/discoveryClient&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;discoveryPing&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RestClientException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ServiceUnavailableException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;URI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serviceUrl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;resolve&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/ping&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;orElseThrow&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServiceUnavailableException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;restTemplate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getForEntity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getBody&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@GetMapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/ping&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;pong&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;em&gt;&amp;quot;myApp/ping&amp;quot;&lt;/em&gt; 路径是带有服务端点的 Spring 应用程序名称。 Consul 将提供所有可用的名为 &lt;em&gt;&amp;quot;myApp&amp;quot;.&lt;/em&gt; 的应用程序&lt;/p&gt;
&lt;h2 id=&#34;4-健康检查&#34;&gt;&lt;strong&gt;4 健康检查&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Consul 会定期检查服务端点的健康状况。&lt;/p&gt;
&lt;p&gt;默认情况下，**Spring 实现健康端点以在应用程序启动时返回 &lt;em&gt;200 OK&lt;/em&gt; **。如果我们想自定义端点，我们必须更新 &lt;em&gt;application.yml:&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  cloud:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    consul:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      discovery:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        healthCheckPath: /my-health-check
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        healthCheckInterval: 20s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;因此，Consul 将每 20 秒轮询一次 &lt;em&gt;&amp;quot;/my-health-check&amp;quot;&lt;/em&gt; 端点。&lt;/p&gt;
&lt;p&gt;让我们定义我们的自定义健康检查服务以返回 &lt;em&gt;FORBIDDEN&lt;/em&gt; 状态：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@GetMapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/my-health-check&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myCustomCheck&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Testing my healh check function&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HttpStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;FORBIDDEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;如果我们访问 Consul 代理站点，我们会看到我们的应用程序失败了。要解决此问题，&lt;em&gt;&amp;quot;/my-health-check&amp;quot;&lt;/em&gt; 服务应返回 HTTP &lt;em&gt;200 OK&lt;/em&gt; 状态代码。&lt;/p&gt;
&lt;h2 id=&#34;5-分布式配置&#34;&gt;&lt;strong&gt;5 分布式配置&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;此功能&lt;strong&gt;允许在所有服务之间同步配置&lt;/strong&gt;。 Consul 将监视任何配置更改，然后触发所有服务的更新。&lt;/p&gt;
&lt;p&gt;首先，我们需要添加&lt;a href=&#34;https://search.maven.org/classic/#search%7Cga%7C1%7Ca%3A%22spring-cloud-starter-consul-config%22&#34;&gt;spring-cloud-starter-consul-config&lt;/a&gt; 的 &lt;em&gt;pom.xml&lt;/em&gt; 的依赖：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;dependence&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-consul-config&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.1.1&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependence&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我们还需要将 Consul 和 Spring 应用程序名称的设置从 &lt;em&gt;application.yml&lt;/em&gt; 文件移动到 Spring 首先加载的 &lt;em&gt;bootstrap.yml&lt;/em&gt; 文件中。&lt;/p&gt;
&lt;p&gt;然后，我们需要启用 Spring Cloud Consul Config：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-纯文本hljs&#34; data-lang=&#34;纯文本hljs&#34;&gt;spring:
  application:
    name: myApp
  cloud:
    consul:
      host: localhost
      port: 8500
      config:
        enabled: true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Spring Cloud Consul Config 将在 Consul 中的 &lt;em&gt;&amp;quot;/config/myApp&amp;quot;&lt;/em&gt; 中查找属性。因此，如果我们有一个名为 &lt;em&gt;&amp;quot;my.prop&amp;quot;&lt;/em&gt; 的属性，我们需要在 Consul 代理站点中创建此属性。&lt;/p&gt;
&lt;p&gt;我们可以通过转到 &lt;em&gt;&amp;quot;KEY/VALUE&amp;quot;&lt;/em&gt; 部分来创建属性，然后在 &lt;em&gt;&amp;quot;Create Key&amp;quot;&lt;/em&gt; 表单中输入 &lt;em&gt;&amp;quot;/config/myApp/my/prop&amp;quot;&lt;/em&gt; 和 &lt;em&gt;&amp;quot;Hello World&amp;quot;&lt;/em&gt; 作为值.最后，单击*“创建”* 按钮。&lt;/p&gt;
&lt;p&gt;请记住，如果我们使用 Spring 配置文件，我们需要将配置文件附加到 Spring 应用程序名称旁边。例如，如果我们使用 &lt;em&gt;dev&lt;/em&gt; 配置文件，Consul 中的最终路径将是 &lt;em&gt;&amp;quot;/config/myApp,dev&amp;quot;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;现在，让我们看看带有注入属性的控制器是什么样子的：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@RestController&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DistributedPropertiesController&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;${my.prop}&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MyProperties&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@GetMapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/getConfigFromValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getConfigFromValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@GetMapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/getConfigFromProperty&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getConfigFromProperty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getProp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;和 &lt;em&gt;MyProperties&lt;/em&gt; 类：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@RefreshScope&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@Configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@ConfigurationProperties&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;my&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MyProperties&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prop&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// standard getter, setter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;如果我们运行应用程序，字段 &lt;em&gt;value&lt;/em&gt; 和 &lt;em&gt;properties&lt;/em&gt; 具有来自 Consul 的相同 &lt;em&gt;&amp;quot;Hello World&amp;quot;&lt;/em&gt; 值。&lt;/p&gt;
&lt;h3 id=&#34;51-更新配置&#34;&gt;&lt;strong&gt;5.1 更新配置&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;在不重启 Spring Boot 应用程序的情况下更新配置怎么办？&lt;/p&gt;
&lt;p&gt;如果我们回到 Consul 代理站点并用另一个值更新属性 &lt;em&gt;&amp;quot;/config/myApp/my/prop&amp;quot;&lt;/em&gt; ，例如 &lt;em&gt;&amp;quot;New Hello World&amp;quot;&lt;/em&gt; ，那么字段 &lt;em&gt;value&lt;/em&gt; 不会改变并且字段&lt;em&gt;properties&lt;/em&gt; 将按预期更新为 &lt;em&gt;&amp;quot;New Hello World&amp;quot;&lt;/em&gt;。&lt;/p&gt;
&lt;p&gt;这是因为字段 &lt;em&gt;properties&lt;/em&gt; 是 &lt;em&gt;MyProperties&lt;/em&gt; 类具有 &lt;em&gt;@RefreshScope&lt;/em&gt; 注释。 &lt;strong&gt;所有带有 &lt;em&gt;@RefreshScope&lt;/em&gt; 注释的 bean 都将在配置更改后刷新。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在现实生活中，我们不应该直接在 Consul 中拥有这些属性，而是应该将它们持久地存储在某个地方。我们可以使用 &lt;a href=&#34;https://blog.fflow.link/spring-cloud-configuration&#34;&gt;Config Server&lt;/a&gt; 来做到这一点。&lt;/p&gt;
&lt;h2 id=&#34;6-结论&#34;&gt;&lt;strong&gt;6 结论&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;在本文中，我们了解了如何设置 Spring Boot 应用程序以与 Consul 一起工作以实现服务发现、自定义健康检查规则并共享分布式配置。&lt;/p&gt;
&lt;p&gt;我们还为客户端引入了许多方法来调用这些注册的服务。&lt;/p&gt;
&lt;p&gt;像往常一样，可以&lt;a href=&#34;https://github.com/eugenp/tutorials/tree/master/spring-cloud-modules/spring-cloud-consul&#34;&gt;在 GitHub 上&lt;/a&gt; 找到源代码。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/java/">Java</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/spring-cloud/">Spring Cloud</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>浅谈 Mock Server</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%B5%85%E8%B0%88-mock-server/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%B5%85%E8%B0%88-mock-server/</guid>
                <pubDate>Tue, 20 Sep 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;what什么是-mock-server&#34;&gt;What？什么是 Mock Server&lt;/h1&gt;
&lt;p&gt;Mock 是模拟的意思。在测试中，通常表述为：对测试过程中不容易构造或者不容易获取的物件，用一个虚拟的物件来进行模拟的一个过程。能够提供 Mock 功能的服务就叫作 Mock Server。 Mock Server 通过模拟真实的服务，提供对来自客户端请求的真实响应。&lt;/p&gt;
&lt;h1 id=&#34;why为什么要用-mock-server&#34;&gt;Why？为什么要用 Mock Server&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;在开发初期先模拟外部接口，避免直接使用实际外部接口进行开发调试，提高开发效率&lt;/li&gt;
&lt;li&gt;全面准确的模拟外部接口的返回，提高自身代码的可靠性，提升验证的全面性
&lt;img src=&#34;https://blog.fflow.link/images/MockServer.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;how怎么用-mock-server&#34;&gt;How？怎么用 Mock Server&lt;/h1&gt;
&lt;p&gt;主要包括两种使用方式，一种是通过一个现成的 Mock Server 服务，这种的好处是对代码无侵入，只需要将调用的 URL 修改为 Mock Server 提供的 URL 即可。另一种是在代码里面显式的编写相关的规则，这样的好处是不再需要单独启用服务，在代码里面就可以完成 Mock，主要在单测的时候使用。&lt;/p&gt;
&lt;h2 id=&#34;使用方式一通过现成的服务打桩&#34;&gt;使用方式一：通过现成的服务打桩&lt;/h2&gt;
&lt;p&gt;可以使用类似 apifox 工具本地/线上打桩，apifox 不仅有基于 Swgger 的 API 管理的能力，同时也具备 API Mock 的功能。具体使用方法可以访问： &lt;a href=&#34;https://www.apifox.cn/&#34;&gt;https://www.apifox.cn/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;使用方式二通过代码打桩&#34;&gt;使用方式二：通过代码打桩&lt;/h2&gt;
&lt;p&gt;MockServer 官方文档 &lt;a href=&#34;http://www.mock-server.com&#34;&gt;http://www.mock-server.com&lt;/a&gt;
Maven 引入&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dependency&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;mock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mockserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;netty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dependency&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dependency&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;mock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mockserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dependency&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;示例一&#34;&gt;示例一&lt;/h3&gt;
&lt;p&gt;ClientAndServer 用法&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.yzy.mock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.integration.ClientAndServer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.Cookie&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.HttpRequest.request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.HttpResponse.response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.Parameter.param&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MockServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ClientAndServer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ClientAndServer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;when&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withPath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withQueryStringParameters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;n&#34;&gt;param&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;p&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;respond&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withCookie&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cookie&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;cKey&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;cValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withBody&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;when&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withPath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withQueryStringParameters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;n&#34;&gt;param&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;p&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;respond&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withBody&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test2&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;启动 main 方法，打开浏览器，输入 http://localhost:1080/test?p=1，页面返回test1，并且成功写入cookie。注意写入的cookie 是Session 级别的，会话关闭将消失。输入http://localhost:1080/test?p=2，页面返回 test2，说明 MockServer 同时监听的两个匹配都有效。&lt;/p&gt;
&lt;h3 id=&#34;示例二&#34;&gt;示例二&lt;/h3&gt;
&lt;p&gt;MockServerClient 用法&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;mock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.http.client.methods.CloseableHttpResponse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.http.client.methods.HttpGet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.http.impl.client.CloseableHttpClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.http.impl.client.HttpClients&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.junit.Rule&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.junit.Test&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.client.MockServerClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.junit.MockServerRule&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.BufferedReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.IOException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.InputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.InputStreamReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.hamcrest.core.IsEqual.equalTo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.junit.Assert.assertThat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.HttpRequest.request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import static&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.mockserver.model.HttpResponse.response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MockServerTest&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Rule&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MockServerRule&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MockServerRule&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IOException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;MockServerClient&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mockClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MockServerClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;localhost&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello world&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;mockClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;when&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withPath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;respond&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withStatusCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;withBody&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;expected&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;CloseableHttpClient&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HttpClients&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;createDefault&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;HttpGet&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;httpGet&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HttpGet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://localhost:1080/hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;CloseableHttpResponse&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;httpGet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;//验证
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;InputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;content&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getEntity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getContent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;InputStreamReader&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inputStreamReader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputStreamReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;BufferedReader&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferedReader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BufferedReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputStreamReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;responseText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferedReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readLine&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responseText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;equalTo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;expected&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%AC%94%E8%AE%B0/">笔记</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>MySQL 和 Redis 事务实现对比</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql-%E5%92%8C-redis-%E4%BA%8B%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%AF%94/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql-%E5%92%8C-redis-%E4%BA%8B%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%AF%94/</guid>
                <pubDate>Mon, 01 Aug 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;我们都知道，如果要实现事务，需要整体保证 ACID(A-原子性|C-持久性|I-隔离性|D-一致性) ，其中一致性是目标，原子性、持久性和隔离性都是手段，所以这里对比一下 MySQL 和 Redis 在事务实现上的区别，当然严格意义上来说，Redis 由于不满足原子性，不能算真正意义上实现了事务。&lt;/p&gt;
&lt;h1 id=&#34;原子性&#34;&gt;原子性&lt;/h1&gt;
&lt;h2 id=&#34;mysql---原子性&#34;&gt;MySQL - 原子性&lt;/h2&gt;
&lt;p&gt;MySQL 的原子性是通过 undolog 保证的，undolog 是 MySQL 的&lt;strong&gt;回滚&lt;/strong&gt;日志，保存的是数据的历史版本，通过历史版本让数据在任何时候都可以回滚到某一个事务开始之前的状态，所以如果事务执行失败了，可以通过 undolog 来保证到原子性。&lt;/p&gt;
&lt;h2 id=&#34;redis---原子性&#34;&gt;Redis - 原子性&lt;/h2&gt;
&lt;p&gt;Redis 没有实现原子性，Redis 的官方文档是这么解释的，所以严格意义上来说，Redis 没有实现事务，因为不能回滚。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It&#39;s important to note that even when a command fails, all the other commands in the queue are processed – Redis will not stop the processing of commands.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;持久性&#34;&gt;持久性&lt;/h1&gt;
&lt;h2 id=&#34;mysql---持久性&#34;&gt;MySQL - 持久性&lt;/h2&gt;
&lt;p&gt;MySQL 的持久性是通过 redolog 保证的，redolog 是 MySQL 的&lt;strong&gt;前滚&lt;/strong&gt;日志，记录数据修改的操作日志，通过操作日志可以保证数据库的数据不丢失。&lt;/p&gt;
&lt;h2 id=&#34;redis---持久性&#34;&gt;Redis - 持久性&lt;/h2&gt;
&lt;p&gt;Redis 严格意义上来说，也没有保证到持久性，这是因为它的持久化策略中不管是 RDB 还是 AOF 都是异步执行的，这样还是有可能会造成数据丢失。
不过 MySQL 除非使用&lt;code&gt;双1&lt;/code&gt;的配置，也就是 sync_binlog  和 innodb_flush_log_at_trx_commit 的配置都是 1，否则也是不满足持久性的；因为如果主机发生异常重启/掉电，还是有可能会造成数据丢失。所以这里可以认为 Redis 部分实现了持久性。&lt;/p&gt;
&lt;h1 id=&#34;隔离性&#34;&gt;隔离性&lt;/h1&gt;
&lt;h2 id=&#34;mysql---隔离性&#34;&gt;MySQL - 隔离性&lt;/h2&gt;
&lt;p&gt;MySQL 里面定义了四种标准的隔离级别，通过 MVCC(Multi-Version Concurrency Control，多版本并发控制) 来实现个不同隔离级别的隔离，简单来说，通过数据的版本来控制数据的可见性。&lt;/p&gt;
&lt;h3 id=&#34;读未提交---read-uncommitted&#34;&gt;读未提交 - Read Uncommitted&lt;/h3&gt;
&lt;p&gt;可能会读到其他事务未提交的数据，也就是&lt;code&gt;脏读&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;读已提交---read-committed&#34;&gt;读已提交 - Read Committed&lt;/h3&gt;
&lt;p&gt;读取的数据可能会前后不一致的情况，因为读取的数据可能在事务执行的过程中被修改了。&lt;/p&gt;
&lt;h3 id=&#34;可重复读---repeatable-read&#34;&gt;可重复读 - Repeatable Read&lt;/h3&gt;
&lt;p&gt;事务一旦开始，事务过程中读取的数据就不能被修改。
但是依然可能会发生&lt;code&gt;幻读&lt;/code&gt;，因为可重复读虽然保护了读取的数据，但是其他数据插入后依然可能满足当前的查询条件，造成&lt;code&gt;幻读&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;序列化---serializable&#34;&gt;序列化 - Serializable&lt;/h3&gt;
&lt;p&gt;系统中的所有事务都串行执行。虽然可以避免所有数据不一致的情况，但是性能下降明显，一般不建议使用。&lt;/p&gt;
&lt;h2 id=&#34;redis---隔离性&#34;&gt;Redis - 隔离性&lt;/h2&gt;
&lt;p&gt;Redis 的事务在执行的过程中，就不会处理其它命令，而是等所有命令都执行完后，再处理其它命令。所以只要执行了 multi，就会阻塞其他操作。因此 Redis 事务是满足隔离性的。&lt;/p&gt;
&lt;h1 id=&#34;总结&#34;&gt;总结&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MySQL&lt;/th&gt;
&lt;th style=&#34;text-align:right&#34;&gt;Redis&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;A - 原子性&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;undo log&lt;/td&gt;
&lt;td style=&#34;text-align:right&#34;&gt;❌&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;C - 持久性&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;redo log&lt;/td&gt;
&lt;td style=&#34;text-align:right&#34;&gt;RDB + AOF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;I - 隔离性&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;MVVC&lt;/td&gt;
&lt;td style=&#34;text-align:right&#34;&gt;命令单进程+单线程执行&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%AC%94%E8%AE%B0/">笔记</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mysql/">MySQL</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-RocketMQ</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/rocketmq/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/rocketmq/</guid>
                <pubDate>Sun, 31 Jul 2022 09:20:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/RocketMQ%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;背景&#34;&gt;背景&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;起源于 [[Kafka]] ，但不是 Kafka 的一个拷贝&lt;/li&gt;
&lt;li&gt;Kafka 多 Topic 的时候性能比较差&lt;/li&gt;
&lt;li&gt;对 Kafka 可靠性传输、事务性做了优化&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;核心架构&#34;&gt;核心架构&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/RocketMQ%20%E6%9E%B6%E6%9E%84.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NameServer&lt;/li&gt;
&lt;li&gt;Broker
&lt;ul&gt;
&lt;li&gt;Master&lt;/li&gt;
&lt;li&gt;Slave&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Producer&lt;/li&gt;
&lt;li&gt;Consumer&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;优势&#34;&gt;优势&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;有现成的管理台界面，便于管理，且可以看到消息的内容&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;支持通过 Tag，Message Header，Message Body 进行过滤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;便于横向扩展&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数据与索引分开存储&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;同时支持推和拉的方式消费&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;多 Topic 的时候性能相对较好&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;一个 Broker 共用一个分区，一个分区支持上万队列&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Kafka 因为是每个 Topic 单独的分区文件，所以在 Topic 较多的时候，机器的 IO 很容易到达瓶颈&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;支持事务发送&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RocketMQ 从 &lt;strong&gt;4.3&lt;/strong&gt; 版本开始支持事务，原理为先预提交消息，然后执行本地事务，执行成功正式 commit 消息，如果没成功 commit，会不断的 check，check 超时则回退本地事务&lt;/li&gt;
&lt;li&gt;LocalTransactionExecuter&lt;/li&gt;
&lt;li&gt;TransactionCheckListener&lt;/li&gt;
&lt;li&gt;&lt;img src=&#34;https://blog.fflow.link/images/RocketMQ%20%E4%BA%8B%E5%8A%A1%E6%B5%81%E7%A8%8B.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/article/2018/08/rocketmq-4.3-release&#34;&gt;RocketMQ 4.3 正式发布，支持分布式事务&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;劣势&#34;&gt;劣势&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;吞吐量没有 Kafka 高 - 一个 Broker 共用一个分区&lt;/li&gt;
&lt;li&gt;一个分区只能对应一个消费者&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;底层原理&#34;&gt;底层原理&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;高吞吐量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Topic 划分为多个分区，提高并发度&lt;/li&gt;
&lt;li&gt;充分利用磁盘顺序读写的性能&lt;/li&gt;
&lt;li&gt;使用 Zero-Copy [[零拷贝]]技术
&lt;ul&gt;
&lt;li&gt;直接在内核态进行数据传输，避免拷贝数据导致内核态和用户态的切换&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;数据批量发送&lt;/li&gt;
&lt;li&gt;数据批量压缩&lt;/li&gt;
&lt;li&gt;消息预先拉取&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主从同步&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;同步双写&lt;/li&gt;
&lt;li&gt;异步复制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;应用场景&#34;&gt;应用场景&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;电商&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;最新进展&#34;&gt;最新进展&lt;/h1&gt;
&lt;h2 id=&#34;存算分离&#34;&gt;存算分离&lt;/h2&gt;
&lt;p&gt;如果是存算融合的方式，无论存储和计算出现问题，都需要迁移机器，但存储扩展通常意味着迁移大量数据。
存算分离由于与任一给定 Topic 相关的数据都不会与特定存储节点进行捆绑，因此很容易替换存储节点或者扩缩容，集群中最小或最慢的节点也不会成为存储或带宽的瓶颈。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;amp;mid=2247508597&amp;amp;idx=1&amp;amp;sn=e18553584ed8796a31c5a9ccbed05263&amp;amp;chksm=e92a9f7ade5d166c40411256a6ee00880dc1d09a361f4b0ea837ad7825dbaa88e515a03a4d7f&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0523uYIVkzYSO0mKV9HS3YcO&amp;amp;sharer_sharetime=1653269879854&amp;amp;sharer_shareid=501ef89633c919d535dedcc1f2858a40&amp;amp;version=4.0.6.90540&amp;amp;platform=mac#rd&#34;&gt;RocketMQ 5.0: 存储计算分离新思路&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;对比&#34;&gt;对比&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;和 [[Kafka]] 的比较
&lt;ul&gt;
&lt;li&gt;吞吐量
&lt;ul&gt;
&lt;li&gt;[[Kafka]] &amp;gt; [[RocketMQ]]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;数据可靠性
&lt;ul&gt;
&lt;li&gt;都支持异步/同步刷盘，但 Kafka 同步刷盘的情况下，性能急剧下降&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;顺序消费
&lt;ul&gt;
&lt;li&gt;都支持顺序消费，但 Kafka 在节点宕机的情况下不能保证消息的顺序性 - 异步复制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mq/">MQ</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>浅谈 Golang 插件机制</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%B5%85%E8%B0%88-golang-%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%B5%85%E8%B0%88-golang-%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6/</guid>
                <pubDate>Sat, 30 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;我们知道类似 Java 等半编译半解释型语言编译生成的都是类似中间态的字节码，所以在 Java 里面我们想要实现程序工作的动态扩展，可以通过 Java 的字节码编辑技术([[动态代理#ASM]]/[[动态代理#CGLIB]])，并结合 JVM 的 [[字节码动态加载#^bc6dd8]] 实现动态修改和加载字节码。&lt;/p&gt;
&lt;p&gt;但是 Golang 是编译型语言，编译后直接生成的是可执行文件，但是如果我们又需要在不发布版本的情况下实现程序功能的动态扩展，我们可以通过什么方式来实现呢？下面主要介绍 Golang 里面实现程序功能动态扩展的两种方式：Golang 原生插件和 go-plugin 插件。&lt;/p&gt;
&lt;h1 id=&#34;golang-原生插件&#34;&gt;Golang 原生插件&lt;/h1&gt;
&lt;p&gt;Golang 原生插件使用流程如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/Golang%20%E5%8E%9F%E7%94%9F%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;将代码编译成 .so 文件&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;PluginName&amp;#34;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;将以上代码使用 &lt;code&gt;go build -buildmode=plugin&lt;/code&gt; 命令即可编译成插件。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;使用插件示例&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// 加载插件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;~/plg.so&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// 查找标识符
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;lookup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lookup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GetName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lookup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;原生插件的弱点&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;编译的 Go 版本必须完全一致 - 事实上这个插件都可以不是由同一个人编写，要求编译的 Go 版本一致显然有点要求太高了&lt;/li&gt;
&lt;li&gt;双方依赖的公共第三方库版本必须完全一致&lt;/li&gt;
&lt;li&gt;GOPATH 也得保持一致 - 不过这一点可以在编译时候使用 trimpath 参数解决&lt;/li&gt;
&lt;li&gt;插件加载之后无法卸载&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;go-plugin&#34;&gt;go-plugin&lt;/h1&gt;
&lt;p&gt;鉴于 Golang 原生插件框架的问题，所以包括 Terraform、Grafana 等系统使用的是 go-plugin 这个框架。go-plugin 使用流程如下。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/go-plugin%20%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;⚠️ 使用的时候注意复用客户端，因为每次初始化实际上是启动了一个子进程，这样会消耗非常多的内存和 CPU 资源。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们看 go-plugin 的使用流程，可以发现其实 go-plugin 是通过在应用内部启动一个服务端子进程，应用通过 rpc 的方式和服务端子进程进行交互来实现插件的动态加载。这样其实几乎可以作为一个编译型语言实现动态加载的通用方案，实际上不是对应用本身做了扩展，而是对应用依赖的接口做了相关的扩展。&lt;/p&gt;
&lt;p&gt;go-plugin 的具体使用可以参考文章最后的链接。&lt;/p&gt;
&lt;h1 id=&#34;参考&#34;&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://wangbjun.site/2021/coding/golang/go-plugin.html&#34;&gt;使用 Go Plugin 实现插件化编程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wangbjun.site/2021/coding/golang/go-rpc-plugin.html&#34;&gt;基于 RPC 实现的 Go 插件机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%AC%94%E8%AE%B0/">笔记</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/go/">Go</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>稳定性保障的方法论</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%BF%9D%E9%9A%9C%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%BF%9D%E9%9A%9C%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA/</guid>
                <pubDate>Fri, 29 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%BF%9D%E9%9A%9C%E7%9A%84%E9%87%91%E5%AD%97%E5%A1%94.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;监控是稳定性的底座，只有具备发现问题的能力，才能有效的解决问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E5%85%A8%E9%93%BE%E8%B7%AF%E4%BD%9C%E6%88%98%E5%9C%B0%E5%9B%BE.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;究竟什么是最有效的稳定性保障方法？
本质上没有银弹，每个项目都需要根据自身的实际情况来决定需要采用的手段。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;单测是不是最有效的方法？
单测是保证代码不出现低级问题的有效方式，但覆盖率提升到一定程度以后，能带来的质量上的提升就非常有限了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TDD 是不是最佳实践？
对于 TDD 的作用，业界的争论还非常多，真正想要在实践中落地也非常困难，但是核心代码要有单测，这个是没有疑问的，但至于说是不是要先写好单测，再来写代码有待商榷。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;微软的去测试化究竟有没有成功？
质量上确实是有在下降，比如说 Windows 10 的质量问题。没有专门测试团队的微软工程师更多的依赖遥测系统，将系统相关的运行数据都进行上报，从而可以全程关注系统的运行情况。不管有没有成功，测试、运维人员都在往更专业的方向发展是不争的事实。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;阿里的去测试化有没有成功？
没有成功，因为去测试话后，质量的下降比较明显，所以绝大多数团队还是保留了一定数量的测试。但和微软一样，测试也在往更专业的方向发展。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;核心是 ROI
小作坊和大酒店的做法就不能一样&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;华为 6+1 为什么没有达到效果？
开发提交代码本地构建时间（6分钟）
开发每日构建时长（20分钟）
测试每日构建时间（20分钟）
测试全量回归时长（2小时）
解决方案流水线时长（8天）
需求从提出到上线时长（1天）
结果：陷入唯指标论，没有实际起到提升研发质量的作用，反而搞了一堆面子工程。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;阿里靠什么达成了双十一的质量和稳定性&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全链路压测&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;监控分层：业务 - 应用（中间件、JVM、DB）- 系统&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E7%9B%91%E6%8E%A7%E5%88%86%E5%B1%82.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;对应了分级的告警策略，电话/短信/企微/邮件&lt;/p&gt;
&lt;p&gt;在 本质上 SRE 也和我们做的运维管理系统类似，管理机器和管理线上设备的思路有时候殊途同归，事前事中事后的整体思路，自动化运维的思路，现在看来都有很多相似之处。&lt;/p&gt;
&lt;p&gt;系统告警模型列表，需包含以下数据：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;关联监控指标&lt;/li&gt;
&lt;li&gt;告警关键级别&lt;/li&gt;
&lt;li&gt;是否上报故障&lt;/li&gt;
&lt;li&gt;是否产生资损&lt;/li&gt;
&lt;li&gt;是否关联故障&lt;/li&gt;
&lt;li&gt;是否关联预案&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;遇到问题先恢复，并保留事发现场。&lt;/p&gt;
&lt;p&gt;常见止血策略：
&lt;img src=&#34;https://blog.fflow.link/images/%E5%B8%B8%E8%A7%81%E6%AD%A2%E8%A1%80%E7%AD%96%E7%95%A5.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;入口限流：调低对应 Provider 服务来源限流值
&lt;ul&gt;
&lt;li&gt;应对突发流量过高导致自身系统、下游强依赖负载被打满&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;下游降级：降级对应下游服务
&lt;ul&gt;
&lt;li&gt;下游弱依赖不可用&lt;/li&gt;
&lt;li&gt;下游业务强依赖经业务同意后降级（业务部分有损）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;单点失败移除：摘除不可用节点
&lt;ul&gt;
&lt;li&gt;单机水位飙高时，先下线不可用单机服务（无需下线机器，保留现场）&lt;/li&gt;
&lt;li&gt;应对集群单点不可用、性能差&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;切换：单元切流或者切换备份
&lt;ul&gt;
&lt;li&gt;应对单库或某单元依赖因为自身原因（宿主机或网络），造成局部流量成功率下跌&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;事故处理方法论：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;明确的职责安排
&lt;ul&gt;
&lt;li&gt;总控，决策团队&lt;/li&gt;
&lt;li&gt;处理团队&lt;/li&gt;
&lt;li&gt;发言人&lt;/li&gt;
&lt;li&gt;规划负责人
&lt;ul&gt;
&lt;li&gt;对于一个需要比较长时间处理的事故，需要有人对相关处理人进行排班&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;明确的职责交接&lt;/li&gt;
&lt;li&gt;作战室&lt;/li&gt;
&lt;li&gt;事故状态实时文档&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.aliyun.com/article/782540&#34;&gt;阿里稳定性保障6步走&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;错误预算&#34;&gt;错误预算&lt;/h1&gt;
&lt;p&gt;错误预算可以被用于上线新功能（阿里也是使用的这种方式），只要研发团队没有超过错误预算，研发团队就可以快速迭代，保持稳定性和服务业务之间的平衡。&lt;/p&gt;
&lt;h1 id=&#34;实例的冗余&#34;&gt;实例的冗余&lt;/h1&gt;
&lt;p&gt;一般情况下，使用 N + 2的实例冗余来维持可靠性和成本之间的平衡。&lt;/p&gt;
&lt;h1 id=&#34;拥抱风险&#34;&gt;拥抱风险&lt;/h1&gt;
&lt;p&gt;用户在一个 99% 可靠性的手机上不能分辨出可靠性 99.9% 和 99.99% 的区别。
所以核心是寻求快速创新和高效服务业务之间的平衡，而不是简单的考虑将在线事件最大化。&lt;/p&gt;
&lt;p&gt;可用性=成功请求数/总请求数&lt;/p&gt;
&lt;h1 id=&#34;各分位延迟情况展示&#34;&gt;各分位延迟情况展示&lt;/h1&gt;
&lt;p&gt;分段延迟情况可以按照直方图展示&lt;/p&gt;
&lt;h1 id=&#34;是否采用临时解决方案&#34;&gt;是否采用临时解决方案&lt;/h1&gt;
&lt;p&gt;临时解决方案可能会影响到真实问题的修复，因为很看团队的领导会不会真的把真实问题的修复在后面放到较高优先级。&lt;/p&gt;
&lt;h1 id=&#34;谷歌-sre-原则&#34;&gt;谷歌 SRE 原则&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;100% 的可用性是不现实的，需要达到这个目标的成本通常远超于所能获得的价值，所以 Google 会针对每种产品设定一个错误预算（容错率），既能保证用户体验又不影响创新和部署的速度。&lt;/li&gt;
&lt;li&gt;在设定目标的时候避免绝对值，使用相对值是一个更合理的选择。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;琐事&lt;/code&gt;就是运维服务中手动性的，重复性的，可以被自动化的，战术性，没有持久价值的工作。&lt;/li&gt;
&lt;li&gt;通过额外努力构建一个平台，而不是仅仅取代现有的手动流程的好处。&lt;/li&gt;
&lt;li&gt;最小 API 是指，不是在不能添加更多的时候，而是没有什么可以去掉的时候，才能达到完美。&lt;/li&gt;
&lt;li&gt;在有垃圾回收（GC）机制的编程环境里，内存的压力通常自然而然地变成 CPU 的压力（在内存受限的情况下，GC 会增加）。&lt;/li&gt;
&lt;li&gt;如果请求没有成功，以指数型延迟重试。&lt;/li&gt;
&lt;li&gt;一定要使用&lt;code&gt;随机化&lt;/code&gt;的、&lt;code&gt;指数型递增&lt;/code&gt;的重试周期。如果重试不是随机分布在重试窗口里的，那么系统出现的一个小故障（某个网络问题）就可能导致重试请求同时出现，这些请求可能会逐渐放大。&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%AC%94%E8%AE%B0/">笔记</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%A8%B3%E5%AE%9A%E6%80%A7/">稳定性</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-MySQL</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql/</guid>
                <pubDate>Thu, 28 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;如何优化分页查询&#34;&gt;如何优化分页查询？&lt;/h1&gt;
&lt;p&gt;大数据量的时候限制用户只能一页一页的往后翻，每次都给出当前页的 maxid，然后基于这个 maxid 查询特定数量的数据&lt;/p&gt;
&lt;h1 id=&#34;可靠性实现&#34;&gt;可靠性实现？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;redolog&lt;/li&gt;
&lt;li&gt;undolog&lt;/li&gt;
&lt;li&gt;binlog&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;事务的可重复读是如何实现的&#34;&gt;事务的可重复读是如何实现的？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;给每行增加两个隐藏字段来实现 MVVC (数据多版本并发控制)，两个列都用来存储事务的版本号&lt;/li&gt;
&lt;li&gt;每开启一个新事务，事务的版本号就会递增&lt;/li&gt;
&lt;li&gt;如果数据的 trx_id 落在低水位，可见&lt;/li&gt;
&lt;li&gt;如果数据的 trx_id 落在高水位，不可见&lt;/li&gt;
&lt;li&gt;如果数据在黄色区间，活跃事务 ID 数组&lt;/li&gt;
&lt;li&gt;trx_id 在数组中，说明未提交，不可见&lt;/li&gt;
&lt;li&gt;trx_id 不在数组中，说明已提交，可见&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;读提交和可重复读实现区别&#34;&gt;读提交和可重复读实现区别？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;可重复读在事务开始的时候创建一致性视图&lt;/li&gt;
&lt;li&gt;读提交在语句执行的时候创建一致性视图&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;redolog-和-undolog-的区别&#34;&gt;redolog 和 undolog 的区别？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;redolog 的前滚日志，undolog 是回滚日志&lt;/li&gt;
&lt;li&gt;redolog 保证持久性，undolog 保证原子性&lt;/li&gt;
&lt;li&gt;undolog 是保存的是数据的历史版本，通过历史版本让数据在任何时候都可以回滚到某一个事务开始之前的状态&lt;/li&gt;
&lt;li&gt;redolog 记录数据修改的操作日志，通过操作日志可以保证数据库的数据不丢失&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/418919493&#34;&gt;https://zhuanlan.zhihu.com/p/418919493&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/213770128&#34;&gt;https://zhuanlan.zhihu.com/p/213770128&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;mysql-如何保证数据不丢失&#34;&gt;MySQL 如何保证数据不丢失？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;两阶段提交，先 prepare，后 commit&lt;/li&gt;
&lt;li&gt;prepare 其实做的一件事情就是刷盘&lt;/li&gt;
&lt;li&gt;如果存在完整的 redolog 则 prepare&lt;/li&gt;
&lt;li&gt;如果 binlog 完整，则提交&lt;/li&gt;
&lt;li&gt;可以保证数据和 binlog 的一致性&lt;/li&gt;
&lt;li&gt;如果不完整，则回退&lt;/li&gt;
&lt;li&gt;如果 commit 已经刷盘，则直接提交&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;myisam-和-innodb-的区别&#34;&gt;MyISAM 和 InnoDB 的区别？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;MyISAM 不支持事务&lt;/li&gt;
&lt;li&gt;MyISAM 不支持行锁&lt;/li&gt;
&lt;li&gt;MyISAM 支持 FULLTEXT 全文索引&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;count-count1-countcol的区别&#34;&gt;count(&lt;code&gt;*&lt;/code&gt;) count(1) count(col)的区别？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;count(&lt;code&gt;*&lt;/code&gt;) = count(1), 统计行不会忽略 NULL&lt;/li&gt;
&lt;li&gt;count(col), 统计行会忽略 col=NULL 的行&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;可重复读隔离级别下mvvc-在数据的-crud-层面分别是如何实现的&#34;&gt;可重复读隔离级别下，MVVC 在数据的 CRUD 层面分别是如何实现的？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;SELECT
&lt;ul&gt;
&lt;li&gt;读取创建版本小于或等于当前事务版本号，并且删除版本为空或大于当前事务版本号的记录。这样可以保证在读取之前记录是存在的&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;INSERT
&lt;ul&gt;
&lt;li&gt;将当前事务的版本号保存至行的创建版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;UPDATE
&lt;ul&gt;
&lt;li&gt;新插入一行，并以当前事务的版本号作为新行的创建版本号，同时将原记录行的删除版本号设置为当前事务版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DELETE
&lt;ul&gt;
&lt;li&gt;将当前事务的版本号保存至行的删除版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;索引命名规范&#34;&gt;索引命名规范？&lt;/h1&gt;
&lt;p&gt;唯一索引 uk 普通索引 idx&lt;/p&gt;
&lt;h1 id=&#34;select-into-from-和-insert-into-select-from-的区别&#34;&gt;select into from 和 insert into select from 的区别？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;select into from 要求目标表不存在&lt;/li&gt;
&lt;li&gt;insert into select from 要求目标表存在&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;如何保证-mysql-不丢数据&#34;&gt;如何保证 MySQL 不丢数据？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;innodb_flush_log_at_trx_commit
设置为 1，每次 commit 都会刷盘，针对 redolog&lt;/li&gt;
&lt;li&gt;sync_binlog
设置为 1，每次提交事务都会执行 fsync，针对 binlog&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;redolog--binlog-写入策略&#34;&gt;redolog + binlog 写入策略&lt;/h1&gt;
&lt;h2 id=&#34;redolog-的写入策略&#34;&gt;redolog 的写入策略&lt;/h2&gt;
&lt;p&gt;InnoDB 提供了 innodb_flush_log_at_trx_commit 参数，它有三种可能取值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置为 0 的时候，表示每次事务提交时都只是把 redolog 留在 redolog buffer 中&lt;/li&gt;
&lt;li&gt;设置为 1 的时候，表示每次事务提交时都将 redolog 直接持久化到磁盘&lt;/li&gt;
&lt;li&gt;设置为 2 的时候，表示每次事务提交时都只是把 redolog 写到 page cache&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;binlog-的写入策略&#34;&gt;binlog 的写入策略&lt;/h2&gt;
&lt;p&gt;binlog 的写入策略，write 和 fsync 的时机，是由参数 sync_ binlog 控制的：&lt;/p&gt;
&lt;p&gt;sync_binlog = 0 的时候，表示每次提交事务都只 write，不 fsync；
sync_binlog = 1 的时候，表示每次提交事务都会执行 fsync；
sync_binlog = N(N&amp;gt;1) 的时候，表示每次提交事务都 write，但累积 N 个事务后才 fsync。
因此，在出现 IO 瓶颈的场景里，将 sync_binlog 设置成一个比较大的值，可以提升性能。在实际的业务场景中，考虑到丢失日志量的可控性，一般不建议将这个参数设成 0，比较常见的是将其设置为 100~1000 中的某个数值。&lt;/p&gt;
&lt;p&gt;但是，将 sync_binlog 设置为N，对应的风险是：如果主机发生异常重启，会丢失最近 N 个事务的 binlog 日志。&lt;/p&gt;
&lt;h2 id=&#34;binlog-日志类型&#34;&gt;binlog 日志类型&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;statment&lt;/li&gt;
&lt;li&gt;mixed&lt;/li&gt;
&lt;li&gt;row&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mixed 模式主要是为了解决 row 模式下，如果执行了表结构变更，row 模式产生的数据量比较大的问题。&lt;/p&gt;
&lt;h2 id=&#34;生产配置&#34;&gt;生产配置&lt;/h2&gt;
&lt;p&gt;通常情况下，生产都是&lt;code&gt;双1&lt;/code&gt;的配置，也就是 sync_binlog  和 innodb_flush_log_at_trx_commit 的配置都是 1，也就是说，一个事务完整提交前，&lt;code&gt;需要等待两次刷盘&lt;/code&gt;，一次是 redolog，一次是 binlog 。&lt;/p&gt;
&lt;h2 id=&#34;性能瓶颈&#34;&gt;性能瓶颈&lt;/h2&gt;
&lt;p&gt;如果你的 MySQL 现在出现了性能瓶颈，而且瓶颈在 IO 上，可以通过哪些方法来提升性能呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置  &lt;code&gt;binlog_group_commit_sync_delay&lt;/code&gt; 和  &lt;code&gt;binlog_group_commit_sync_no_delay_count参数&lt;/code&gt;，减少 binlog 的写盘次数。这个方法是基于“额外的故意等待”来实现的，因此可能会增加语句的响应时间，但没有丢失数据的风险。&lt;/li&gt;
&lt;li&gt;将 sync_ binlog  设置为大于 1 的值（比较常见是 100~1000）。这样做的风险是，主机掉电时会丢 binlog 日志。&lt;/li&gt;
&lt;li&gt;将 innodb_flush_log_at_trx_commit 设置为 2。这样做的风险是，主机掉电的时候会丢数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不建议把 innodb_flush_log_at_trx_commit 设置成 0。因为把这个参数设置成 0，表示 redolog 只保存在内存中，这样的话 MySQL 本身异常重启也会丢数据，风险太大。而 redolog 写到文件系统的 page cache 的速度也是很快的，所以将这个参数设置成 2 跟设置成 0 其实性能差不多，但这样做 MySQL 异常重启时就不会丢数据了，相比之下风险会更小。&lt;/p&gt;
&lt;h1 id=&#34;mysql-为什么建议使用自增组件&#34;&gt;MySQL 为什么建议使用自增组件？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;便于范围查询&lt;/li&gt;
&lt;li&gt;避免插入的时候页分裂，影响插入效率&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mysql/">MySQL</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-MySQL 索引</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql-%E7%B4%A2%E5%BC%95/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/mysql-%E7%B4%A2%E5%BC%95/</guid>
                <pubDate>Thu, 28 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;类别&#34;&gt;类别&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;普通索引&lt;/li&gt;
&lt;li&gt;唯一索引&lt;/li&gt;
&lt;li&gt;主键索引&lt;/li&gt;
&lt;li&gt;全文索引&lt;/li&gt;
&lt;li&gt;组合索引&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;实现机制&#34;&gt;实现机制&lt;/h1&gt;
&lt;h2 id=&#34;b树&#34;&gt;B+树&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/B+%E6%A0%91%E7%BB%93%E6%9E%84.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;mysql-为什么使用-b-树做索引&#34;&gt;MySQL 为什么使用 B+ 树做索引？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;非叶子节点不含数据，在查找数据的时候查询磁盘次数少&lt;/li&gt;
&lt;li&gt;叶子节点的深度一样，查询稳定&lt;/li&gt;
&lt;li&gt;叶子节点之间有指针进行连接，便于进行顺序遍历和范围查找&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;sql-执行计划&#34;&gt;SQL 执行计划&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;通过 SQL 分析工具&lt;/li&gt;
&lt;li&gt;Explain&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;什么情况下会失效&#34;&gt;什么情况下会失效？&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;or&lt;/code&gt; 关键字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;like&lt;/code&gt; 的模糊查询以 &lt;code&gt;%&lt;/code&gt; 开头&lt;/li&gt;
&lt;li&gt;组合索引使用的不是第一部分&lt;/li&gt;
&lt;li&gt;列类型是字符串，但是查询条件中没有使用 &amp;quot;&amp;quot;&lt;/li&gt;
&lt;li&gt;MySQL 内部机制认为不使用比使用快的其他情况&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mysql/">MySQL</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-乐观锁和悲观锁</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</guid>
                <pubDate>Thu, 28 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;乐观锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;出发点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;认为数据一般情况下不会造成冲突&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;并发好效率高&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缺点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ABA 问题
&lt;ul&gt;
&lt;li&gt;解决方法
&lt;ul&gt;
&lt;li&gt;版本号&lt;/li&gt;
&lt;li&gt;时间戳&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用场景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;读多写少，数据冲突不大的情况，考虑用户积分加减的场景&lt;/li&gt;
&lt;li&gt;因为如果冲突比较大，事务需要回滚，应用层也会不断重试，这样反倒降低的性能&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SQL&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;update table set name = &#39;FFlow&#39;, version = version + 1 where id = #{id} and version = #{version};&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先不上锁，但如果 SQL 执行失败应用层需要自己处理，比如重试&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;悲观锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;出发点
&lt;ul&gt;
&lt;li&gt;认为数据比较大可能会发生冲突&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;使用场景
&lt;ul&gt;
&lt;li&gt;数据冲突比较大的情况&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;使用方式
&lt;ul&gt;
&lt;li&gt;每次在拿数据的时候都会上锁，这样别人想拿这个数据就会 block 直到它拿到锁&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;SQL
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;select ... id=1 for update&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;使用场景
&lt;ul&gt;
&lt;li&gt;支付类场景，因为实际上悲观锁编写逻辑相对简单，不容易造成故障&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mysql/">MySQL</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-网络</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/network/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/network/</guid>
                <pubDate>Thu, 28 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;我们现在基于TCP/IP的网络一般划分为四层：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/TCP%E5%8D%8F%E8%AE%AE%E6%A0%88.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;应用层&#34;&gt;应用层&lt;/h1&gt;
&lt;h2 id=&#34;httphttps&#34;&gt;HTTP/HTTPS&lt;/h2&gt;
&lt;h3 id=&#34;http-11-版本特性&#34;&gt;HTTP 1.1 版本特性&lt;/h3&gt;
&lt;h4 id=&#34;keepalive&#34;&gt;keepalive&lt;/h4&gt;
&lt;p&gt;长连接，一次只能发送一个请求&lt;/p&gt;
&lt;h4 id=&#34;pipeline&#34;&gt;pipeline&lt;/h4&gt;
&lt;p&gt;长连接，一次可以发送多个请求&lt;/p&gt;
&lt;h3 id=&#34;http20-对比-http1x-的优势&#34;&gt;HTTP/2.0 对比 HTTP/1.x 的优势&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;HTTP/2.0&lt;/code&gt; 是相比于 HTTP/1.x &lt;code&gt;更快&lt;/code&gt;(性能提升 3 倍以上)，&lt;code&gt;更简单&lt;/code&gt;，&lt;code&gt;更稳定&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP/2.0 是&lt;code&gt;二进制协议&lt;/code&gt;，HTTP/1.x 是文本协议&lt;/li&gt;
&lt;li&gt;HTTP/2.0 会进行&lt;code&gt;头部压缩&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;HTTP/1.x 只支持 Payload 压缩&lt;/li&gt;
&lt;li&gt;HTTP/2.0 使用的是 Hpack 方式压缩，核心是对通用的字段使用标记位进行压缩，类似于协议中特定的字节表示特定的含义&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HTTP/2.0 引入&lt;code&gt;连接多路复用&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;HTTP/1.1 使用&lt;strong&gt;长连接&lt;/strong&gt;进行连接复用，而且客户端可以同时发出多个请求，但是服务端需要按照发送请求的顺序进行回复，所以可能会产生&lt;strong&gt;队头阻塞&lt;/strong&gt;的的问题&lt;/li&gt;
&lt;li&gt;HTTP/2.0 支持同一连接同时发起多个请求，减少服务端连接压力&lt;/li&gt;
&lt;li&gt;HTTP/2.0 多个请求通过流进行通信，而且两端可以通过&lt;code&gt;帧的标识&lt;/code&gt;识别属于哪个请求，这样就不用像 HTTP/1.1 需要按照发送请求的顺序进行回复，提高了整体的性能&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HTTP/2.0 支持&lt;code&gt;服务端推送&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/pipelining%20%E5%89%8D%E5%90%8E%E5%AF%B9%E6%AF%94.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E5%B8%A7.png&#34; alt=&#34;&#34;&gt;
[ 二进制分帧 ]&lt;/p&gt;
&lt;h3 id=&#34;实现推的几种方式&#34;&gt;实现推的几种方式&lt;/h3&gt;
&lt;h4 id=&#34;简易轮询&#34;&gt;简易轮询&lt;/h4&gt;
&lt;p&gt;这是最简单暴力的方法，客户端定时轮询，这种方法最大的好处是实现简单，但是如果客户端较多，服务端的压力会很大。&lt;/p&gt;
&lt;h4 id=&#34;long-polling&#34;&gt;Long-Polling&lt;/h4&gt;
&lt;p&gt;为了解决定时轮询里面服务端压力比较大的问题，也可以使用 Long-Polling 来实现从推送数据，简单来说，就是服务端先 hold 住客户端发送过来的请求，直到服务端的数据有变化才返回，[[配置中心]] Apollo 里面就是用的这种方式实现配置的推送。&lt;/p&gt;
&lt;h4 id=&#34;websocket&#34;&gt;WebSocket&lt;/h4&gt;
&lt;p&gt;区别于简易轮询和 Long-Polling，WebSocket 没有在 HTTP 协议上做文章，直接实现了一套新的全双工的消息交互协议，客户端既可以向服务端发送消息内容，服务端也可以向服务端发送消息内容，相对简易轮询和 Long-Polling 来说实现较为复杂。&lt;/p&gt;
&lt;h3 id=&#34;常用状态码&#34;&gt;常用状态码&lt;/h3&gt;
&lt;h4 id=&#34;200&#34;&gt;200&lt;/h4&gt;
&lt;p&gt;成功&lt;/p&gt;
&lt;h4 id=&#34;204&#34;&gt;204&lt;/h4&gt;
&lt;p&gt;空返回&lt;/p&gt;
&lt;h4 id=&#34;403&#34;&gt;403&lt;/h4&gt;
&lt;p&gt;没有权限&lt;/p&gt;
&lt;h4 id=&#34;404&#34;&gt;404&lt;/h4&gt;
&lt;p&gt;没有找到资源&lt;/p&gt;
&lt;h4 id=&#34;405&#34;&gt;405&lt;/h4&gt;
&lt;p&gt;客户端请求中的方法被禁止&lt;/p&gt;
&lt;h4 id=&#34;500&#34;&gt;500&lt;/h4&gt;
&lt;p&gt;内部服务错误&lt;/p&gt;
&lt;h4 id=&#34;502&#34;&gt;502&lt;/h4&gt;
&lt;p&gt;无效响应&lt;/p&gt;
&lt;h4 id=&#34;504&#34;&gt;504&lt;/h4&gt;
&lt;p&gt;超时&lt;/p&gt;
&lt;h3 id=&#34;https-加密过程&#34;&gt;HTTPS 加密过程&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/HTTPS%20%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ssh&#34;&gt;SSH&lt;/h2&gt;
&lt;h2 id=&#34;ftpstfp&#34;&gt;FTP/STFP&lt;/h2&gt;
&lt;h1 id=&#34;传输层&#34;&gt;传输层&lt;/h1&gt;
&lt;h2 id=&#34;tcp&#34;&gt;TCP&lt;/h2&gt;
&lt;p&gt;典型的传输层协议包括 TCP、UDP 协议，重点要关注的是 TCP 的三次握手，四次挥手。具体请看图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;TCP 是全双工协议，所以客户端和服务端都可以发起关闭连接请求。&lt;/p&gt;
&lt;h3 id=&#34;为什么关闭连接需要四次挥手&#34;&gt;为什么关闭连接需要四次挥手？&lt;/h3&gt;
&lt;p&gt;客户端发起关闭请求的时候，只是说客户端不再发送数据了，但服务端这个时候还有可能继续接收到之前的数据；所以这个时候服务端先返回一个收到关闭请求的回复，等服务端完成剩余数据的处理，再回复确认可以关闭连接。&lt;/p&gt;
&lt;h3 id=&#34;弱网环境下四次挥手会有什么问题&#34;&gt;弱网环境下四次挥手会有什么问题？&lt;/h3&gt;
&lt;p&gt;一直关不掉连接，连接被占满，Time-Wait 过多&lt;/p&gt;
&lt;h3 id=&#34;time-wait-和-close-wait-的含义&#34;&gt;Time-Wait 和 Close-Wait 的含义&lt;/h3&gt;
&lt;h4 id=&#34;time-wait&#34;&gt;Time-Wait&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Time-Wait 过多的原因？
网络不稳定&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Time-Wait 过多的解决办法？
net.ipv4.tcp_tw_reuse = 1
表示开启重用。允许将 TIME-WAIT sockets 重新用于新的 TCP 连接
net.ipv4.tcp_tw_recycle = 1
表示开启 TCP 连接中 TIME-WAIT sockets 的快速回收&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为什么要等待 2MSL ( MSL 为最长报文寿命)
保证这次连接的重复数据段从网络中消失
服务端如果没收到最后一次第三次挥手的确认，会重新发一遍第三次挥手的报文，所以如果 2MSL 里面没有收到任何报文，就代表连接已经关闭了&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;close-wait&#34;&gt;Close-Wait&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Close-Wait 过多的原因？
谁主动发起关闭连接的请求，对方就有可能出现 Close-Wait 的情况，大多数情况是客户端代码没有关闭流的操作导致的。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;udp&#34;&gt;UDP&lt;/h2&gt;
&lt;p&gt;面向无连接的传输层协议&lt;/p&gt;
&lt;h1 id=&#34;网络层&#34;&gt;网络层&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;IP&lt;/li&gt;
&lt;li&gt;ICMP&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;数据链路层&#34;&gt;数据链路层&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ARP&lt;/li&gt;
&lt;li&gt;RARP&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%BD%91%E7%BB%9C/">网络</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/tcp/">TCP</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/http/">HTTP</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>架构整洁之道笔记</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E7%AC%94%E8%AE%B0/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E7%AC%94%E8%AE%B0/</guid>
                <pubDate>Thu, 28 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;设计原则&#34;&gt;设计原则&lt;/h1&gt;
&lt;h2 id=&#34;单一职责原则&#34;&gt;单一职责原则&lt;/h2&gt;
&lt;p&gt;任何一个软件模块都应该有且仅有一个被修改的原因。&lt;/p&gt;
&lt;h2 id=&#34;开闭原则&#34;&gt;开闭原则&lt;/h2&gt;
&lt;h2 id=&#34;里氏替换原则&#34;&gt;里氏替换原则&lt;/h2&gt;
&lt;h2 id=&#34;接口隔离原则&#34;&gt;接口隔离原则&lt;/h2&gt;
&lt;p&gt;在一般情况下，任何层次的软件设计如果依赖于不需要的东西，都会是有害的。从源代码层次来说，这样的依赖关系会导致不必要的重新编译和重新部署，对更高层次的软件架构设计来说，问题也是类似的。&lt;/p&gt;
&lt;h2 id=&#34;依赖倒置原则&#34;&gt;依赖倒置原则&lt;/h2&gt;
&lt;h1 id=&#34;编程范式&#34;&gt;编程范式&lt;/h1&gt;
&lt;h2 id=&#34;结构化编程&#34;&gt;结构化编程&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;结构化编程&lt;/code&gt;是对程序控制权的直接转移的限制 - 限制 goto 语句。
软件架构师需要定义可以方便地进行证伪（测试）的模块、组件以及服务。为了达到这个目的，他们需要将类似结构化编程的限制方法应用在更高的层面上。&lt;/p&gt;
&lt;h2 id=&#34;面向对象编程&#34;&gt;面向对象编程&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;面向对象编程&lt;/code&gt;是对程序控制权的间接转移的限制 - 依赖倒置。&lt;/p&gt;
&lt;h2 id=&#34;函数式编程&#34;&gt;函数式编程&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;函数式编程&lt;/code&gt;是对程序中赋值操作的限制 - 所有的竞争问题、死锁问题、并发更新问题都是由可变变量导致的。&lt;/p&gt;
&lt;h1 id=&#34;软件构建过程的三个步骤&#34;&gt;软件构建过程的三个步骤&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&amp;quot;先让代码工作起来&amp;quot;——如果代码不能工作，就不能产生价值。&lt;/li&gt;
&lt;li&gt;&amp;quot;然后再试图将它变好&amp;quot;——通过对代码进行重构，让我们自己和其他人更好地理解代码，并能按照需求不断地修改代码。&lt;/li&gt;
&lt;li&gt;&amp;quot;最后再试着让它运行得更快&amp;quot;——按照性能提升的&amp;quot;需求&amp;quot;来重构代码。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;的确，优秀的软件设计师和架构师会花费很大精力来设计接口，以减少未来对其进行改动。毕竟争取在不修改接口的情况下为软件增加新的功能是软件设计的基础常识。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不要强迫一个组件的用户依赖他们不需要的东西&lt;/strong&gt;。要尽可能的不要依赖的特定的组件，特定的依赖也就意味着如果想迁移到其他地方做私有化部署也非常困难。&lt;/p&gt;
&lt;p&gt;软件架构师自身需要是程序员，&lt;code&gt;并且必须一直坚持做一线程序员&lt;/code&gt;，绝对不要听从那些说应该让软件架构师从代码中解放出来以专心解决高阶问题的伪建议。&lt;/p&gt;
&lt;p&gt;在系统的早期开发中，开发人员可能会决定采用某种&amp;quot;微服务架构&amp;quot;。这种架构的组件边界清晰，接口稳定，非常利于开发。但当我们实际部署这种系统时，就会发现其微服务的数量已经大到令人望而生畏，而配置这些微服务之间的连接以及启动时间都会成为系统出错的主要来源。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据库选型这个事情应该是要尽量延后的&lt;/strong&gt;，需要根据实际情况做出最有利于自己的选择。&lt;/p&gt;
&lt;p&gt;优秀的架构师会小心地将软件的高层策略与其底层实现隔离开，让高层策略与实现细节脱钩，使其策略部分完全不需要关心底层细节，当然也不会对这些细节有任何形式的依赖。另外，优秀的架构师所设计的策略应该允许系统尽可能地推迟与实现细节相关的决策，越晚做决策越好。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;康威定律&lt;/code&gt;：任何一个组织在设计系统时，往往都会复制出一个与该组织内沟通结构相同的系统。&lt;/p&gt;
&lt;p&gt;这个故事的悲剧之处在于，软件架构师通过一个草率的决定无谓地将开发成本放大了数倍之多。&lt;/p&gt;
&lt;p&gt;本质上，所有的软件系统都是一组策略语句的集合。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们一定要带着怀疑的态度审视每一个框架&lt;/strong&gt;。是的，采用框架可能会很有帮助，但采用它们的成本呢？我们一定要懂得权衡如何使用一个框架，如何保护自己。无论如何，我们需要仔细考虑如何能保持对系统用例的关注，避免让框架主导我们的架构设计。&lt;/p&gt;
&lt;p&gt;总之，&lt;strong&gt;不要投机取巧地直接传递业务实体或数据库记录对象&lt;/strong&gt;。同时，这些传递的数据结构中也不应该存在违反依赖规则的依赖关系。&lt;/p&gt;
&lt;p&gt;Main 组件中的依赖关系通常应该由依赖注入框架来注入。在该框架将依赖关系注入到 Main 组件之后，Main 组件就应该可以在不依赖于该框架的情况下自行分配这些依赖关系了。&lt;/p&gt;
&lt;p&gt;虽然软件本身并不会随时间推移而磨损，但硬件及其固件却会随时间推移而过时，随即也需要对软件做相应改动。&lt;/p&gt;
&lt;p&gt;以 Spring 为例，它作为一个依赖注入框架是不错的，也许我们会需要用 Spring 来自动连接应用程序中的各种依赖关系。这不要紧，但是千万别在业务对象里到处写 @Autowired 注解。业务对象应该对 Spring 完全不知情才对。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%AC%94%E8%AE%B0/">笔记</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E6%9E%B6%E6%9E%84/">架构</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Redis</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/redis/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/redis/</guid>
                <pubDate>Wed, 27 Jul 2022 09:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;背景&#34;&gt;背景&lt;/h1&gt;
&lt;p&gt;关系数据库访问数据较慢&lt;/p&gt;
&lt;h1 id=&#34;目标&#34;&gt;目标&lt;/h1&gt;
&lt;p&gt;提高数据的访问速度&lt;/p&gt;
&lt;h1 id=&#34;优势&#34;&gt;优势&lt;/h1&gt;
&lt;p&gt;数据访问速度较快&lt;/p&gt;
&lt;h1 id=&#34;劣势&#34;&gt;劣势&lt;/h1&gt;
&lt;p&gt;数据存放在内存中，容量存在限制&lt;/p&gt;
&lt;h1 id=&#34;底层原理&#34;&gt;底层原理&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;内存数据库&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;持久化方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RDB
&lt;ul&gt;
&lt;li&gt;介绍
&lt;ul&gt;
&lt;li&gt;在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是 fork 一个子进程，先将数据集写入临时文件，写入成功后，在替换之前的文件，用二进制压缩存储&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;优势
&lt;ul&gt;
&lt;li&gt;适合进行备份&lt;/li&gt;
&lt;li&gt;适合进行灾备&lt;/li&gt;
&lt;li&gt;对 Redis 的性能压力比较小&lt;/li&gt;
&lt;li&gt;RDB 在恢复大数据集的速度比 AOF 恢复速度要快&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;劣势
&lt;ul&gt;
&lt;li&gt;RDB 有可能会丢失分钟级的数据&lt;/li&gt;
&lt;li&gt;如果数据集比较大，且 CPU 紧张的情况下，Redis 停止服务的时间可能会比较长&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;AOF
&lt;ul&gt;
&lt;li&gt;以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录&lt;/li&gt;
&lt;li&gt;优势
&lt;ul&gt;
&lt;li&gt;AOF 只会丢失秒级的数据&lt;/li&gt;
&lt;li&gt;AOF 只进行追加&lt;/li&gt;
&lt;li&gt;AOF 文件的可读性较好&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;劣势
&lt;ul&gt;
&lt;li&gt;对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积&lt;/li&gt;
&lt;li&gt;AOF 的速度可能会比 RDB 慢&lt;/li&gt;
&lt;li&gt;AOF 可能会拖慢 Redis 的访问速度&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;部署架构&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主从复制&lt;/li&gt;
&lt;li&gt;哨兵&lt;/li&gt;
&lt;li&gt;集群
&lt;ul&gt;
&lt;li&gt;Master 之间分配 slots，一共 16384 个 slot&lt;/li&gt;
&lt;li&gt;slot 不完整，集群失效&lt;/li&gt;
&lt;li&gt;每个 Master 都会有 Slave&lt;/li&gt;
&lt;li&gt;扩缩容需要手动重新分片&lt;/li&gt;
&lt;li&gt;先到其中任何一台执行，没执行成功会将客户端转向正确的节点执行命令&lt;/li&gt;
&lt;li&gt;Redis 提供了命令供管理员自动迁移 slots&lt;/li&gt;
&lt;li&gt;使用 CRC16(KEY) mod 16384 的值，决定将 key 放到哪个槽中&lt;/li&gt;
&lt;li&gt;去中心化设计，每个节点都是对等的，保存全量的元数据信息&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;应用场景&#34;&gt;应用场景&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;查多写少&lt;/li&gt;
&lt;li&gt;热点数据&lt;/li&gt;
&lt;li&gt;不适合存储持久化数据&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;底层原理-1&#34;&gt;底层原理&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;底层数据结构&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;String&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;embstr&lt;/li&gt;
&lt;li&gt;SDS&lt;/li&gt;
&lt;li&gt;len，free&lt;/li&gt;
&lt;li&gt;redisObject&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HMap&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hashtable
&lt;ul&gt;
&lt;li&gt;元素比较多时&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ziplist
&lt;ul&gt;
&lt;li&gt;适用于元素较小时&lt;/li&gt;
&lt;li&gt;key 和 value 都被推到队尾&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;List&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ziplist
&lt;ul&gt;
&lt;li&gt;使用连续空间，节省空间，但只能保存小整数或者小字符串&lt;/li&gt;
&lt;li&gt;ziplist 如何压缩空间
&lt;ul&gt;
&lt;li&gt;小数字和大数字不一样，小数子只用一个字节存储&lt;/li&gt;
&lt;li&gt;不需要前后指针&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;linkedlist
&lt;ul&gt;
&lt;li&gt;双端链表&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;inset
&lt;ul&gt;
&lt;li&gt;inset 编码的集合对象使用整数集合作底层实现，集合对象包含所有元素都会被保存在整数集合里面&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;hashtable&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SortedSet&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;skiplist
&lt;ul&gt;
&lt;li&gt;使用 ZRANGE 和 ZREVERANGE 比较多&lt;/li&gt;
&lt;li&gt;内存占用不多&lt;/li&gt;
&lt;li&gt;实现比较简单&lt;/li&gt;
&lt;li&gt;&lt;img src=&#34;https://blog.fflow.link/images/%E8%B7%B3%E8%A1%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/9d8296562806&#34;&gt;https://www.jianshu.com/p/9d8296562806&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ziplist&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HyperLogLog&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;统计元素数量&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GEO&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;地理位置&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;一致性 Hash&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;背景
&lt;ul&gt;
&lt;li&gt;取模的方式扩缩容的时候对缓存命中率的影响比较大&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;原理
&lt;ul&gt;
&lt;li&gt;将整个 hash 值空间组织成一个虚拟的圆环&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;扩容
&lt;ul&gt;
&lt;li&gt;只影响添加节点后面的节点（顺时针）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;缩容
&lt;ul&gt;
&lt;li&gt;只影响删除节点后面的数据（顺时针）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;问题
&lt;ul&gt;
&lt;li&gt;当节点较少的时候，容易因为节点分布不均匀，产生缓存热点的问题
&lt;ul&gt;
&lt;li&gt;使用虚拟节点，改善一致性 Hash 的问题&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;具体实现
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/snowwhite/p/9672185.html&#34;&gt;https://www.cnblogs.com/snowwhite/p/9672185.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;过期策略&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定期删除&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;默认是每隔 100ms 就随机抽取一些一些设置了过期的 key&lt;/li&gt;
&lt;li&gt;如果此时 key 已经过期，就删除，不会返回任何东西&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;惰性删除&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键，如果没有过期，就返回该键&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定时删除&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从设置 key 的过期时间开始，就启动一个定时器，到时间就删除该key&lt;/li&gt;
&lt;li&gt;对内存比较友好，但浪费 CPU 资源&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;复制原理&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;slave 第一次连接或者重连，会触发一次全量同步&lt;/li&gt;
&lt;li&gt;主节点做一个 bgsave，同时将后续修改操作记录到内存 buffer，如果 buffer 超过限定的值，则复制失败。待完成后将 rdb 文件全量同步到复制节点，复制节点接受完成后将 rdb 镜像加载到内存，加载完成后，再通知主节点将期间修改的操作记录同步到复制节点进行重放就完成了同步过程&lt;/li&gt;
&lt;li&gt;后续 Master 手机到的写命令都会通过之前建立的连接，增量发送给 slave 端&lt;/li&gt;
&lt;li&gt;slave 执行 buffer 中的命令&lt;/li&gt;
&lt;li&gt;slave 异步方式执行同步&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;复制时机&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;全量复制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;slave 首次启动或重启&lt;/li&gt;
&lt;li&gt;slave 不满足部分复制的条件&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;部分复制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主从的 Redis 版本 &amp;gt;= 2.8&lt;/li&gt;
&lt;li&gt;slave 只是掉线&lt;/li&gt;
&lt;li&gt;slave 保存的 run id 与 master 当前 run id 一致&lt;/li&gt;
&lt;li&gt;slave 掉线期间，master 保存在内存的 offset 可用&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数据丢失&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;异步复制导致的数据丢失&lt;/li&gt;
&lt;li&gt;Master 突然宕机，Slave 有些数据还没有同步过来&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;脑裂导致的数据丢失&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;发生主从切换，但是客户端还在往 Master 写入数据&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;事务&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ACID&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原子性&lt;/li&gt;
&lt;li&gt;持久性
&lt;ul&gt;
&lt;li&gt;AOF 在总是 SYNC 的模式下，因为主线程不会阻塞到写入完成，所以不能保证持久性&lt;/li&gt;
&lt;li&gt;RDB 的情况下，事务执行完成后，服务器可能在 RDB 未更新之前失败，所以也不可能保证持久性&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;隔离性&lt;/li&gt;
&lt;li&gt;一致性&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用方法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WATCH&lt;/li&gt;
&lt;li&gt;MULTI&lt;/li&gt;
&lt;li&gt;EXEC&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;过期算法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ttl&lt;/li&gt;
&lt;li&gt;lru&lt;/li&gt;
&lt;li&gt;random&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;对比&#34;&gt;对比&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MongoDB&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;非关系数据库&lt;/li&gt;
&lt;li&gt;非内存数据库&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Memcached&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;内存数据库&lt;/li&gt;
&lt;li&gt;支持的数据结构较少&lt;/li&gt;
&lt;li&gt;不能持久化&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;客户端驱动&#34;&gt;客户端驱动&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Jedis&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;偏数据库驱动，API 提供了比较全面的 Redis 命令的支持&lt;/li&gt;
&lt;li&gt;高性能，分布式特性和丰富的结构，让使用者能够将精力更集中地放在处理业务逻辑上&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisson&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;底层原理
&lt;ul&gt;
&lt;li&gt;使用 [[Netty]] 作为通信组件&lt;/li&gt;
&lt;li&gt;将一些操作组合成 Script 实现特定的功能&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;问题
&lt;ul&gt;
&lt;li&gt;MapCache 有内存溢出风险&lt;/li&gt;
&lt;li&gt;在编解码失败的时候可能会造成某些命令执行时间过长&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;相关问题&#34;&gt;相关问题&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;缓存命中率&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存穿透&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决方法&lt;/li&gt;
&lt;li&gt;缓存预热&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存雪崩&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决方法
&lt;ul&gt;
&lt;li&gt;使用高可用架构&lt;/li&gt;
&lt;li&gt;服务降级，使用本地缓存&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存击穿&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;让 key 不在一个时间段集中失效，加或减一个随机值&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为什么使用单线程&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU 不是瓶颈点，IO 是瓶颈点，单线程够用也简单&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis 集群做迁移的时候怎么查找数据？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;单个 key 迁移的过程中会阻塞，所以如果没找到 key 会重新 ask 一遍&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;常用命令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scan 176 MATCH *11* COUNT 1000&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;常见优化&#34;&gt;常见优化&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Master 最好不要做任何持久化工作，如 RDB 内存快照和 AOF 日志文件&lt;/li&gt;
&lt;li&gt;如果数据比较重要，某个 Slave 开启 AOF 备份数据，策略设置为每秒同步一次&lt;/li&gt;
&lt;li&gt;为了主从复制的速度和连接的稳定性，Master 和 Slave 最好在同一个局域网内&lt;/li&gt;
&lt;li&gt;尽量避免在压力很大的主库增加从库&lt;/li&gt;
&lt;li&gt;主从复制不要用图状结构，用单向链表结构更为稳定，即：Master &amp;lt; Slave1 &amp;lt; Slave2 ...&lt;/li&gt;
&lt;li&gt;Redis 的连接数一般设置为 CPU 的核数 * 单核的最大连接&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/redis/">Redis</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Java 内存溢出的排查方法</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%9A%84%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%9A%84%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95/</guid>
                <pubDate>Tue, 19 Jul 2022 15:48:04 &#43;0800</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;内存溢出分类&#34;&gt;内存溢出分类&lt;/h1&gt;
&lt;p&gt;Java 里面内存溢出主要分以下几种：&lt;/p&gt;
&lt;h2 id=&#34;堆溢出&#34;&gt;堆溢出&lt;/h2&gt;
&lt;p&gt;1、内存溢出（无法申请到内存）
jstat 查看内存使用情况，检查堆参数，一般是申请的内存太大，比如一个特别大的 byte 数组&lt;/p&gt;
&lt;p&gt;2、内存泄漏（对象无法回收）
可以使用 MAT 工具里面的 Path to GC Roots 定位，一般是一个特大不能回收的对象&lt;/p&gt;
&lt;h2 id=&#34;栈溢出&#34;&gt;栈溢出&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;StackOverflowError
方法调用层次太深，内存不够新建栈帧，比如一个没有结束条件的递归&lt;/li&gt;
&lt;li&gt;OutOfMemoryError
线程太多，内存不够新建线程&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;metaspace-数据区溢出&#34;&gt;MetaSpace 数据区溢出&lt;/h2&gt;
&lt;p&gt;动态生成大量 Class&lt;/p&gt;
&lt;h2 id=&#34;本地直接内存溢出&#34;&gt;本地直接内存溢出&lt;/h2&gt;
&lt;p&gt;申请一个大的直接内存&lt;/p&gt;
&lt;h2 id=&#34;数据超限内存溢出&#34;&gt;数据超限内存溢出&lt;/h2&gt;
&lt;p&gt;分配的数据结构在此平台不可寻址&lt;/p&gt;
&lt;h1 id=&#34;排查方法&#34;&gt;排查方法&lt;/h1&gt;
&lt;h2 id=&#34;jdk-自带命令&#34;&gt;JDK 自带命令&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jstat -gcutil &lt;span class=&#34;m&#34;&gt;33816&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;250&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 监控 jvm 的内存使用情况&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jps -ml &lt;span class=&#34;c1&#34;&gt;# 输出虚拟机启动时传递给主类 main() 的参数，输出主类的全名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jmap -F -dump:live,format&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;b,file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;dump.bin &lt;span class=&#34;m&#34;&gt;85962&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# dump 堆内存&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 分析方法&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 可以使用 VisualVM，主要查看是否存在大对象，然后分析为什么没有被回收&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jstack -F -l -m &lt;span class=&#34;m&#34;&gt;85962&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 显示虚拟机快照&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jstack -l PID &amp;gt;&amp;gt; test.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jmap -histo pid &lt;span class=&#34;c1&#34;&gt;# 实时查看JVM对象大小的排序结果，但无法看到对象的具体内容&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;arthas&#34;&gt;Arthas&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 找到最耗CPU的方法&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;thread -n &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 观察方法的返回&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;watch com.test.MyClass query returnObj
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 反编译类&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jad com.test.MyClass
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 监控调用情况&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;monitor -c &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; com.test.MyClass query
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 查看分段的调用时间&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;trace com.test.MyClass query
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 查看方法完整的调用链&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;stack com.test.MyClass query
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 记录调用现场&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tt -t com.test.MyClass query
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;参数检查&#34;&gt;参数检查&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xms 初始堆大小
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xmx 最大堆大小
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Xmn 新生代大小
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;XX:MaxMetaSpaceSize 元数据区大小
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Survivor Eden与Survivor区的大小比值
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/oom/">OOM</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/java/">Java</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Golang GPM 原理介绍</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/golang-gpm%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/golang-gpm%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/</guid>
                <pubDate>Tue, 10 May 2022 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;h1 id=&#34;基础概念&#34;&gt;基础概念&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;G
&lt;ul&gt;
&lt;li&gt;用户发起的协程&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;P
&lt;ul&gt;
&lt;li&gt;抽象处理器，有了它才能建立G、M的联系&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;M
&lt;ul&gt;
&lt;li&gt;操作系统的线程&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;核心机制&#34;&gt;核心机制&lt;/h1&gt;
&lt;h2 id=&#34;初始轮流分配p&#34;&gt;初始轮流分配P&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/%E5%88%9D%E5%A7%8B%E8%BD%AE%E6%B5%81%E5%88%86%E9%85%8DP.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;p的队列已塞满&#34;&gt;P的队列已塞满&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/P%E7%9A%84%E9%98%9F%E5%88%97%E5%B7%B2%E5%A1%9E%E6%BB%A1.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;m获取g&#34;&gt;M获取G&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/M%E8%8E%B7%E5%8F%96G.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;没找到g&#34;&gt;没找到G&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/%E6%B2%A1%E6%89%BE%E5%88%B0G.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;g在阻塞状态&#34;&gt;G在阻塞状态&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;转去执行其他的G&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/G%E5%9C%A8%E9%98%BB%E5%A1%9E%E7%8A%B6%E6%80%81.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;g进行系统调用&#34;&gt;G进行系统调用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;转去执行其他的G &lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/G%E8%BF%9B%E8%A1%8C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;g完成系统调用&#34;&gt;G完成系统调用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;G完成系统调用 &lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/go-gpm/G%E5%AE%8C%E6%88%90%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/golang/">Golang</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/gpm/">GPM</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>如何实现三个线程轮流输出1-100</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/multi-thread-print-100/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/multi-thread-print-100/</guid>
                <pubDate>Sat, 21 Sep 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;如何实现三个线程轮流输出1-100, 这个问题在面试中经常会问到，之前有写过，但不是很合理，最近有点新想法重新写了一稿，直接看代码吧。&lt;/p&gt;
&lt;!--more --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.hunter.train.common.print&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.ExecutorService&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.Executors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.locks.Condition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.locks.ReentrantLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ConcurrentPrinter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExecutorService&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;executor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Executors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newFixedThreadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getRuntime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;availableProcessors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAX_COUNT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THREAD_NUM&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Printer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Runnable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Printer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;counter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;self&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;currentThread&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;:&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addAndGet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;c1&#34;&gt;// 这样另外的线程就能拿到锁了
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;signal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;c1&#34;&gt;// 如果满足这个条件，说明已经不会再轮到自己了，也就没必要再等了
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAX_COUNT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THREAD_NUM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;n&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addAndGet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCondition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCondition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCondition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;executor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;submit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Printer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;executor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;submit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Printer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;executor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;submit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Printer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;executor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-微服务分布式事务</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-transaction/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-transaction/</guid>
                <pubDate>Sat, 10 Aug 2019 09:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了几种常见的微服务分布式事务。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-transaction/java-transaction.png&#34; alt=&#34;分布式事务&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1tcc&#34;&gt;1.	TCC&lt;/h4&gt;
&lt;p&gt;柔性事务
最终一致性
作用在服务层&lt;/p&gt;
&lt;h4 id=&#34;2txc&#34;&gt;2.	TXC&lt;/h4&gt;
&lt;p&gt;2.1.	分布式应用里面，多条数据库记录被同时修改带来的一致性问题
fascar&lt;/p&gt;
&lt;h4 id=&#34;3xa&#34;&gt;3.	XA&lt;/h4&gt;
&lt;p&gt;作用在资源层，依赖于数据库对XA协议的支持&lt;/p&gt;
&lt;h4 id=&#34;4区别&#34;&gt;4.	区别&lt;/h4&gt;
&lt;p&gt;4.1.	概要
&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-transaction/java-transaction-compare.png&#34; alt=&#34;分布式事务比较&#34;&gt;&lt;/p&gt;
&lt;p&gt;4.2.	XA是资源层面的分布式事务，强一致性，在两阶段提交的整个过程中，一直会持有资源的锁
4.3.	TCC是业务层面的分布式事务，最终一致性，不会一直持有资源的锁
4.4.	XA一般对应用开发者屏蔽
4.5.	TCC没有对开发者屏蔽，开发者还需要自己实现接口&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E4%BA%8B%E5%8A%A1/">事务</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-ElasticSearch</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-es/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-es/</guid>
                <pubDate>Fri, 09 Aug 2019 13:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了ElasticSearch的基本原理。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-es/java-es.png&#34; alt=&#34;ES&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1背景&#34;&gt;1.	背景&lt;/h4&gt;
&lt;p&gt;1.1.	MySQL支持的数据量大小有限&lt;/p&gt;
&lt;h4 id=&#34;2优化&#34;&gt;2.	优化&lt;/h4&gt;
&lt;p&gt;2.1.	数据预热
手动/自动慢慢刷到filesystem cache里面&lt;/p&gt;
&lt;p&gt;2.2.	冷热分离
因为filesystem cache有限，所以可以将非热点的数据写到额外的索引里面，同事也可以使用大内存调大filesystem cache&lt;/p&gt;
&lt;h4 id=&#34;3架构&#34;&gt;3.	架构&lt;/h4&gt;
&lt;p&gt;3.1.	shard
replica
master&lt;/p&gt;
&lt;h4 id=&#34;4原理&#34;&gt;4.	原理&lt;/h4&gt;
&lt;p&gt;4.1.	倒排索引
4.2.	准实时数据库
每1s从buffer刷新到oscache
4.3.	2000w数据500M
4.4.	如何查询？
先随机找一个Node执行，然后再从这个Node向各个节点发起查询做聚合&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/es/">ES</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-微服务注册中心</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-registry/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-registry/</guid>
                <pubDate>Thu, 08 Aug 2019 13:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了几种常见的微服务注册中心。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-registry/java-registry.png&#34; alt=&#34;注册中心&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1eureka&#34;&gt;1.	Eureka&lt;/h4&gt;
&lt;p&gt;1.1.	架构
1.1.1.	Eureka Server
提供服务注册和发现
1.1.2.	Service Provider
将自身服务注册到Eureka，从而使服务消费方能够找到
1.1.3.	Service Consumer
从Eureka获取注册服务列表，从而能够消费服务
1.2.	AP型注册中心&lt;/p&gt;
&lt;h4 id=&#34;2zookeeper&#34;&gt;2.	Zookeeper&lt;/h4&gt;
&lt;p&gt;CP型注册中心&lt;/p&gt;
&lt;h4 id=&#34;3nacos&#34;&gt;3.	Nacos&lt;/h4&gt;
&lt;p&gt;阿里开源的注册和配置中心&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/">注册中心</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-微服务配置中心</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-config/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-config/</guid>
                <pubDate>Wed, 07 Aug 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对微服务中常见的几种配置中心进行了介绍和对比。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-config/java-config.png&#34; alt=&#34;微服务配置中心对比&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1apollo&#34;&gt;1.	Apollo&lt;/h4&gt;
&lt;p&gt;1.1.	特性
统一管理不同环境、不同集群的配置
配置修改实时生效
版本发布管理
灰度发布
部署简单&lt;/p&gt;
&lt;p&gt;1.2.	部署架构
1.2.1.	ConfigService
提供配置获取接口
提供配置推送接口
服务于Apollo客户端
1.2.2.	AdminService
提供配置管理接口
提供配置修改发布接口
服务于管理界面Portal
1.2.3.	Portal
配置管理界面
通过MetaServer获取ConfigService的服务列表
使用客户端软负载SLB方式调用AdminService
1.2.4.	Client
为应用获取配置，支持实时更新
通过MetaServer获取ConfigService的列表
使用客户端软负载SLB方式调用ConfigService&lt;/p&gt;
&lt;h4 id=&#34;2disconf&#34;&gt;2.	disconf&lt;/h4&gt;
&lt;p&gt;不支持灰度发布
不支持部分更新&lt;/p&gt;
&lt;h4 id=&#34;3spring-cloud-config&#34;&gt;3.	spring-cloud-config&lt;/h4&gt;
&lt;p&gt;依赖git&lt;/p&gt;
&lt;h4 id=&#34;4nacos&#34;&gt;4.	Nacos&lt;/h4&gt;
&lt;p&gt;阿里开源的注册和配置中心&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/">配置中心</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Dubbo</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-dubbo/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-dubbo/</guid>
                <pubDate>Tue, 06 Aug 2019 15:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍了Dubbo的一些常见问题及其使用方式。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-dubbo/java-dubbo.png&#34; alt=&#34;Dubbo&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1部署架构&#34;&gt;1.	部署架构&lt;/h4&gt;
&lt;p&gt;Provider
Consumer
Registry
Monitor
Container&lt;/p&gt;
&lt;h4 id=&#34;2架构图&#34;&gt;2.	架构图&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-dubbo/dubbo-structure.png&#34; alt=&#34;Dubbo架构图&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;3序列化协议&#34;&gt;3.	序列化协议&lt;/h4&gt;
&lt;p&gt;3.1.	hessian&lt;/p&gt;
&lt;h4 id=&#34;4为什么pb的效率是最高的&#34;&gt;4.	为什么PB的效率是最高的&lt;/h4&gt;
&lt;p&gt;4.1.	使用proto编译器，自动进行序列化和反序列化，速度非常快
4.2.	数据压缩效果非常好&lt;/p&gt;
&lt;h4 id=&#34;5负载均衡策略&#34;&gt;5.	负载均衡策略&lt;/h4&gt;
&lt;p&gt;5.1.	随机
默认&lt;/p&gt;
&lt;p&gt;5.2.	轮询
按权重轮询&lt;/p&gt;
&lt;p&gt;5.3.	最少活跃调用&lt;/p&gt;
&lt;p&gt;5.4.	一致性哈希&lt;/p&gt;
&lt;h4 id=&#34;6集群容错策略&#34;&gt;6.	集群容错策略&lt;/h4&gt;
&lt;p&gt;6.1.	failover cluster模式
失败重试&lt;/p&gt;
&lt;p&gt;6.2.	failfast cluster模式
立即失效，适用于非幂等性操作&lt;/p&gt;
&lt;p&gt;6.3.	failsafe cluster模式
忽略失败&lt;/p&gt;
&lt;p&gt;6.4.	failback cluster模式
定时重发&lt;/p&gt;
&lt;p&gt;6.5.	forking cluster模式
并行调用&lt;/p&gt;
&lt;p&gt;6.6.	broadcast cluster模式&lt;/p&gt;
&lt;h4 id=&#34;7使用方式&#34;&gt;7.	使用方式&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;@EnableDubbo，@Scan， @Refer&lt;/li&gt;
&lt;li&gt;Spring XML&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/dubbo/">Dubbo</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-动态代理</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-aop/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-aop/</guid>
                <pubDate>Mon, 05 Aug 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍了Java里面实现动态代理的几种方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-aop/java-aop.png&#34; alt=&#34;Java动态代理&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1jdk&#34;&gt;1.	JDK&lt;/h4&gt;
&lt;p&gt;1.1.	优点
JDK自带，不需要额外引用&lt;/p&gt;
&lt;p&gt;1.2.	缺点
只能实现接口里面方法的代理
速度慢&lt;/p&gt;
&lt;p&gt;1.3.	实现机制
根据接口方法动态生成对应的代理类，代理类再将请求转发到InvocationHandler实现类的invoke方法上&lt;/p&gt;
&lt;h4 id=&#34;2cglib&#34;&gt;2.	CGLIB&lt;/h4&gt;
&lt;p&gt;2.1.	优点
Spring使用的动态代理方法
代码的可读性高&lt;/p&gt;
&lt;p&gt;2.2.	缺点
速度相对来说你较慢&lt;/p&gt;
&lt;p&gt;2.3.	实现机制
根据接口或者类生成通过继承方式动态生成代理类，代理类再将请求转发到MethodInterceptor的intercept方法上
基于ASM包装&lt;/p&gt;
&lt;h4 id=&#34;3javassist&#34;&gt;3.	JAVASSIST&lt;/h4&gt;
&lt;p&gt;3.1.	优点
Dubbo使用的动态代理方法
速度较快&lt;/p&gt;
&lt;p&gt;3.2.	缺点
代码可读性不高&lt;/p&gt;
&lt;p&gt;3.3.	实现机制
和JDK类似，使用代理工厂
通过类似用户自定义的动态代码直接生成代理类&lt;/p&gt;
&lt;h4 id=&#34;4asm&#34;&gt;4.	ASM&lt;/h4&gt;
&lt;p&gt;4.1.	优点
速度快
4.2.	缺点
可读性差&lt;/p&gt;
&lt;h4 id=&#34;5性能参考&#34;&gt;5.	性能参考&lt;/h4&gt;
&lt;p&gt;5.1.	https://javatar.iteye.com/blog/814426&lt;/p&gt;
&lt;h4 id=&#34;6其他参考&#34;&gt;6.	其他参考&lt;/h4&gt;
&lt;p&gt;6.1.	https://www.cnkirito.moe/rpc-dynamic-proxy&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">动态代理</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-微服务限流熔断</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-limiter/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-limiter/</guid>
                <pubDate>Sun, 04 Aug 2019 23:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java微服务里面常见的限流熔断机制及其优缺点进行了总结。Java里面限流熔断主要有两种方式实现：一种是利用Hystrix，另外一种是阿里的Sentinel，两种互有优缺点，可以根据业务的实际情况进行选择。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-limiter/java-limiter.png&#34; alt=&#34;微服务限流熔断&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1hystrix&#34;&gt;1.	Hystrix&lt;/h4&gt;
&lt;p&gt;1.1.	功能
熔断
限流
降级&lt;/p&gt;
&lt;p&gt;1.2.	资源隔离
线程池
信号量机制&lt;/p&gt;
&lt;p&gt;1.3.	和Dubbo结合
使用Filter&lt;/p&gt;
&lt;p&gt;1.4.	相关参数都可以在初始化的时候设置，需要实现降级的接口&lt;/p&gt;
&lt;p&gt;1.5.	执行流程图
&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-limiter/hystrix.png&#34; alt=&#34;Hystrix执行流程图&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;2sentinel&#34;&gt;2.	Sentinel&lt;/h4&gt;
&lt;p&gt;2.1.	主要特性
&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-limiter/sentinel.png&#34; alt=&#34;Sentinel主要特性&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;3sentinel-与-hystrix-的对比&#34;&gt;3.	Sentinel 与 Hystrix 的对比&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-limiter/compare.png&#34; alt=&#34;Sentinel 与 Hystrix 的对比&#34;&gt;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E9%99%90%E6%B5%81/">限流</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%86%94%E6%96%AD/">熔断</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-JVM类加载机制</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-classloader/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-classloader/</guid>
                <pubDate>Sat, 03 Aug 2019 23:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java类加载的时机、类加载的过程和几种常见的类加载器进行了总结。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-classloader/java-classloader.png&#34; alt=&#34;JVM类加载机制&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1类加载的时机&#34;&gt;1.	类加载的时机&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;创建类实例的时候，读取或者设置一个类的静态字段（被final修饰，已在编译期把结果放入常量池的除外），以及调用一个类的静态方法的时候。&lt;/li&gt;
&lt;li&gt;对类进行反射调用的时候，如果没有进行过初始化则需要先出发其初始化过程。&lt;/li&gt;
&lt;li&gt;当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先出发其父类的初始化过程。&lt;/li&gt;
&lt;li&gt;当虚拟机启动时，定义了入口（含有main（）方法的那个类）的主类，虚拟机会先初始化这个主类。&lt;/li&gt;
&lt;li&gt;当使用JDK1.7及以上的版本中的动态语言支持时，若一个java.lang.invoke.MethodHandle实例最后的解析结果是：REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先出发它的初始化过程。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2类加载的过程&#34;&gt;2.	类加载的过程&lt;/h4&gt;
&lt;p&gt;2.1.	加载
2.2.	验证
2.2.1.	文件格式验证
保证输入的字节流能正常解析
2.2.2.	元数据验证
对元数据进行与语义校验
2.2.3.	字节码验证
对数据流和控制流进行分析
2.2.4.	符号引用验证
目标:确保解析动作正常执行
对类自身以外的信息进行校验
2.2.5.	-Xverify:none 参数关闭大部分验证措施
2.3.	准备
2.4.	解析
2.4.1.	符号引用转化为直接引用
2.5.	初始化&lt;/p&gt;
&lt;h4 id=&#34;3类加载器&#34;&gt;3.	类加载器&lt;/h4&gt;
&lt;p&gt;3.1.	双亲委派模型
3.1.1.	类加载器
启动类加载器 BootStrap ClassLoader
扩展类加载器 Extend ClassLoader
应用程序类加载器 App ClassLoader
3.1.2.	工作过程
让父类先加载，父类加载失败才自己加载
3.1.3.	目的
安全性
避免重复加载
3.2.	破坏双亲委派模型
3.2.1.	不遵循父类先加载的原则
3.2.2.	举例
DriverManager
&lt;a href=&#34;https://blog.csdn.net/u012129558/article/details/81540804&#34;&gt;https://blog.csdn.net/u012129558/article/details/81540804&lt;/a&gt;
3.3.	自定义加载器&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/java/">Java</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-网络编程</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-io/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-io/</guid>
                <pubDate>Fri, 02 Aug 2019 23:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对UNIX的五种IO模型，特别是我们最常常用的epoll的工作原理做了简要介绍，总结了一下Java里面几种IO模型对应的实现方式。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-io/java-io.png&#34; alt=&#34;Java网络编程&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1unix五种io模型&#34;&gt;1.	UNIX五种IO模型&lt;/h4&gt;
&lt;p&gt;1.1.	IO&lt;/p&gt;
&lt;p&gt;1.2.	NIO&lt;/p&gt;
&lt;p&gt;1.3.	I/O多路复用（select, poll, Linux 2.6中改进的epoll）
1.3.1.	主要方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;select&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;poll
为了解决select支持的fd大小为1024的问题，poll改变了fds的集合描述方式，使用了poll_fd而不是fd_set结构&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;epoll
执行epoll_create，创建了红黑树和就绪链表
执行epoll_ctl，如果增加socket句柄，则检查在红黑树中是否存在，存在立即返回，不存在则添加到红黑树，然后向内核注册回调函数，用于当中断事件来临时向准备就绪链表中插入数据
执行epoll_wait时立刻返回准备就绪链表里的数据
LT和ET模式（水平触发和边缘触发），LT模式下，只要一个句柄上的事件一次没有处理完，后面调用epoll_wait时还会返回这个句柄，而ET模式仅在第一次返回&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.3.2.	区别&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select和poll每次调用都需要遍历整个fd，直到设备就绪，期间睡眠和唤醒多次交替，而epoll_wait执行的时候只需要遍历就绪链表中的节点
select/poll每次调用都需要把fd集合从用户态往内核态拷贝一次，而epoll只需要在调用epoll_ctl的时候拷贝一次
select支持的fd数量较小，默认是1024，而epoll里面fd的最大值为系统最多可打开的fd数目，这个数字一般远大于1024
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;参考：
&lt;a href=&#34;https://blog.csdn.net/russell_tao/article/details/7160071&#34;&gt;https://blog.csdn.net/russell_tao/article/details/7160071&lt;/a&gt;
&lt;a href=&#34;https://www.cnblogs.com/Anker/p/3265058.html&#34;&gt;https://www.cnblogs.com/Anker/p/3265058.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.4.	信号驱动I/O&lt;/p&gt;
&lt;p&gt;1.5.	AIO&lt;/p&gt;
&lt;h4 id=&#34;2io&#34;&gt;2.	IO&lt;/h4&gt;
&lt;p&gt;2.1.	面向流
2.2.	阻塞
2.3.	无Selector&lt;/p&gt;
&lt;h4 id=&#34;3nio&#34;&gt;3.	NIO&lt;/h4&gt;
&lt;p&gt;3.1.	基本概念
3.1.1.	同步异步
关注事件发生时的行为
3.1.2.	阻塞非阻塞
关注等待事件时的状态&lt;/p&gt;
&lt;p&gt;3.2.	组件
3.2.1.	Channel&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;FileChannel
文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;transferFrom
将数据从源通道传输到FileChannel&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;transferTo
将数据从FileChannel传输到其他Channel&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DatagramChannel
UDP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SocketChannel
TCP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ServerSocket
监听套接字&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;3.2.2.	ByteBuffer&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;属性
Position
Limit
Capacity&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重要方法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;flip
读写模式切换&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;clear&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;compact
类型&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;3.2.3.	Scatter/Gather&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Scatter
一个Channel分散到多个Buffer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gather
多个Channel收集到一个Buffer&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;3.2.4.	Selector
SelectionKey
就绪时间集合
Accept, Connect, Read, Write&lt;/p&gt;
&lt;p&gt;3.2.5.	Pipe
管道是2个线程间的单向数据连接
Source(读), Sink(写)&lt;/p&gt;
&lt;p&gt;3.3.	特点
面向缓冲
非阻塞
选择器Selector&lt;/p&gt;
&lt;h4 id=&#34;4aio&#34;&gt;4.	AIO&lt;/h4&gt;
&lt;p&gt;4.1.	AsynchronousFileChannel
4.2.	AsynchronousSocketChannel
4.3.	AsynchronousServerSocketChannel
4.4.	AsynchronousChannelGroup
处理IO的线程组
4.5.	监控/控制 异步操作
Future，Future.get
回调 CompletionHandler&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%BD%91%E7%BB%9C/">网络</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-并发编程</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-concurrent/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-concurrent/</guid>
                <pubDate>Thu, 01 Aug 2019 21:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java并发编程里面常用的线程池、线程状态、线程协同、锁进行了总结，这些几乎是Java面试里面必问的内容，特别是线程池的参数，不仅要能讲出具体的参数有哪些和参数的意义，也要对一个新线程submit到线程池后，线程池是如何进行处理的流程了然于胸。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-concurrent/java-concurrent.png&#34; alt=&#34;Java并发编程&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;线程池
1.1.	线程&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;创建线程的方法
实现Runnable或Callable接口
继承Thread类&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.2.	线程池类型&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;NewFixedThreadPool
固定线程大小，无边界队列&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NewWorkStealingPool
实际的线程数不固定，也不保证线程的执行顺序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NewSingleThreadPool
单线程，无边界队列&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NewCachedThreadPool
适合执行时间较短的任务，只要线程不够则新建&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NewScheduledThreadPool
定时执行线程&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.3.	ThradPoolExecutor线程池参数&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;corePoolSize
核心线程数&lt;/li&gt;
&lt;li&gt;maximumPoolSize
最大线程数&lt;/li&gt;
&lt;li&gt;keepAliveTime
超过核心线程数的线程，最大的存活时间&lt;/li&gt;
&lt;li&gt;unit
存活时间单位&lt;/li&gt;
&lt;li&gt;workQueue
任务队列&lt;/li&gt;
&lt;li&gt;handler
如果已经超过最大线程数，继续有新的线程处理类
AbortPolicy
直接抛出RejectExecutionException异常
CallerRunsPolicy
重试添加当前的任务
DiscardOldestPolicy
抛弃最老的任务
DiscardPolicy
抛弃当前的任务&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.4.	BlockingQueue
1.4.1.	实现类
ArrayBlockingQueue
数组实现队列
LinkedBlockingQueue
链表实现队列
PriorityBlockingQueue
优先级队列
可自定义Comparator
DelayQueue
延时获取元素队列，队列的元素需要实现Delayed接口
SynchronousQueue
不存储元素的阻塞队列，只有在消费者试图获取元素的时候生产者才能插入元素
LinkedTransferQueue
transfer(E e)
若存在消费者线程，即立刻移交; 否则插入元素到队尾
tryTransfer(E e)
若存在消费者线程，即立刻移交; 否则返回fasle
tryTransfer(E e, long timeout, TimeUnit unit)
若存在消费者线程，即立刻移交; 否则插入元素到队尾，如果指定时间内没有被消费，则返回false并将元素移除
LinkedBlockingDeque
双向阻塞队列
1.4.2.	常用方法
add(E)
超过容量抛出异常
offer(E)
超过容量返回false
put(E)
超过容量阻塞
offer(E,long,TimeUnit)
超过容量并插入超时返回false
take()
为空则阻塞
poll(long,TimeUnit)
为空并获取超时则返回null
remove(Object)
删除特定元素&lt;/p&gt;
&lt;h4 id=&#34;2线程状态&#34;&gt;2.	线程状态&lt;/h4&gt;
&lt;p&gt;2.1.	新建
2.2.	就绪
2.3.	阻塞
2.4.	运行
2.5.	死亡&lt;/p&gt;
&lt;h4 id=&#34;3线程协同&#34;&gt;3.	线程协同&lt;/h4&gt;
&lt;p&gt;3.1.	CountDownLatch
用于某个线程等待其他线程执行完成之后它才执行，不可重用&lt;/p&gt;
&lt;p&gt;3.2.	CyclicBarrier
用于一组线程池互相等待至某个状态，然后这组线程再同时执行，可重用&lt;/p&gt;
&lt;p&gt;3.3.	Semaphore
资源使用控制&lt;/p&gt;
&lt;p&gt;3.4.	Exchanger
两个线程同时交换数据&lt;/p&gt;
&lt;p&gt;3.5.	Thread.join()
等待子线程执行完成，执行完成之后可以执行主线程&lt;/p&gt;
&lt;h4 id=&#34;4锁&#34;&gt;4.	锁&lt;/h4&gt;
&lt;p&gt;4.1.	synchronized
4.1.1.	三个阶段
偏向锁
在对象头上的Mark Word部分设置线程ID
轻量级锁
轻量级锁依赖CAS操作Mark Word来试图获取锁
重量级锁
monitorenter和monitorexit
4.1.2.	不可重入锁&lt;/p&gt;
&lt;p&gt;4.2.	ReentrantLock
4.2.1.	可重入锁
基于AQS来实现，首先尝试用CAS(LOCK_IF_MP)来获取锁，如果没有获取到，就加入到FIFO的链表里面，然后锁如果被释放了，通知链表里面的第一个节点获取锁
4.2.2.	提供了Condition用于线程间通信
4.2.3.	提供了tryAcquire方法，用于超时没有获取到锁的处理&lt;/p&gt;
&lt;p&gt;4.3.	ReentrantReadWriteLock
写线程访问时，所有的读和其他写线程都阻塞&lt;/p&gt;
&lt;h4 id=&#34;5容器类&#34;&gt;5.	容器类&lt;/h4&gt;
&lt;p&gt;5.1.	ConcurrentHashMap
5.2.	CopyOnWriteArrayList
5.3.	ConcurrentLinkedQueue
5.3.1.	和LinkedQueue相比没有poll操作
5.4.	LinkedHashMap
5.4.1.	和HashMap相比，遍历Map的时候会根据插入顺序来遍历
5.5.	HashMap
5.5.1.	如何扩容？
节点数大于阈值的时候触发扩容
直接扩大两倍，然后需要将老桶的数据迁移到新桶，所以并发的时候会有问题&lt;/p&gt;
&lt;h4 id=&#34;6happen-before&#34;&gt;6.	happen before&lt;/h4&gt;
&lt;p&gt;线程的启动与停止
加锁与解锁
volatile变量的读和写
读的时候确认方法区的共享变量有没有更新
程序顺序原则
传递性原则&lt;/p&gt;
&lt;h4 id=&#34;7常见问题&#34;&gt;7.	常见问题&lt;/h4&gt;
&lt;p&gt;7.1.	如何解决Atomic类CAS操作时产生的ABA问题？
使用AtomicStampedReference给对象加上版本号&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%BA%BF%E7%A8%8B/">线程</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-分布式锁</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-lock/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-lock/</guid>
                <pubDate>Wed, 31 Jul 2019 13:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java里面常见的分布式锁的实现方式和优缺点进行了总结。Java里面实现分布式锁主要分为两种：一种是基于Redis组件，另外一种是基于Zookeeper实现，两种互有优缺点，可以根据业务的实际情况进行选择。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-lock/java-lock.png&#34; alt=&#34;MQ思维导图&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1利用redis&#34;&gt;1.	利用Redis&lt;/h4&gt;
&lt;p&gt;1.1.	实现方式
setnx，成功的获得说，并设置锁的超时时间
用户定义的名字为锁名，只为一个map，map的key为uuid:threadid,value为访问次数，因为是可重入锁，所以相当于可能被一个线程获取多次，获取多次再unlock的话，还是不能直接释放掉，只能先将value-1，并继续续，如果真正释放锁，需要将释放的消息publish给其他请求锁的客户端
1.2.	问题1
1.2.1.	描述
锁超时
1.2.2.	解决方法
启一个定时任务根据线程id不断的去续期
1.3.	问题2
1.3.1.	描述
redis节点可能宕机
1.3.2.	解决方法
同时从多个节点获取锁，全部获取成功才算成功拿到锁&lt;/p&gt;
&lt;h4 id=&#34;2利用zk&#34;&gt;2.	利用zk&lt;/h4&gt;
&lt;p&gt;2.1.	实现方式
2.1.1.	公平锁
创建Sequence节点，最小的获取成功，客户端只监控前一节点的key，缺点是获取锁的速度慢
2.1.2.	非公平锁
创建临时节点，创建成功的获取成功，缺点是获取锁的客户端多的情况下，zk需要通知的节点太多，zk不一定能扛得住&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E9%94%81/">锁</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Linux</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-linux/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-linux/</guid>
                <pubDate>Tue, 30 Jul 2019 11:22:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java中的常用的命令进行了简要介绍。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-linux/java-linux.png&#34; alt=&#34;Java GC&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1常用命令&#34;&gt;1.	常用命令&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看/opt/test下的文件列表&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ls /opt/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 修改/opt/test的文件权限&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	chmod &lt;span class=&#34;m&#34;&gt;755&lt;/span&gt; /opt/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 修改test.txt的文件属主&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	chown mateinfo:inoc test.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 删除文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	rm -rf /opt/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;find
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查找文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	find ./ -name &lt;span class=&#34;s2&#34;&gt;&amp;#34;test.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ln
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 设置软链接&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ln -s log2019.log link2019
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看文件的内容&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	cat test.config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 挂载目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    mount /dev/hda1 /mnt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 创建目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	mkdir -p /opt/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tar
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 压缩文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tar -czvf test.tar.gz a.c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;# 解压文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    tar -xzvf test.tar.gz -c dstdir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gzip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 压缩文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	gzip test.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;# 解压文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    gzip -dv test.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 替换test.txt中的my为hunter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	sed -i &lt;span class=&#34;s2&#34;&gt;&amp;#34;s/my/hunter/g&amp;#34;&lt;/span&gt; test.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;awk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看含有test且含有test1的行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;/test/&amp;amp;&amp;amp;/test1/&amp;#39;&lt;/span&gt; test.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查找app.log中含有ERROR的行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	grep -C10 -Hn ERROR app.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tail
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 实时打印日志&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tail -100f app.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;less
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	less app.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;more
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	more app.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看java进程&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	ps -ef &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep java
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;top
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看系统的状态&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	top
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;netstat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看端口9819是否为监听状态&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	netstat -an &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  grep &lt;span class=&#34;m&#34;&gt;9819&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -i listen
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsof
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看端口9819是否打开&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	lsof -i:9819
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;kill&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 杀掉pid为9819的进程&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nb&#34;&gt;kill&lt;/span&gt; -9 &lt;span class=&#34;m&#34;&gt;9819&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 抓取指定地址的TCP包&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tcpdump src host 100.100.65.59 dst port &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; -w capture.cap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 设置防护的规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	iptables -A OUTPUT -s 10.0.10.62 -p tcp --sport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 将testfile_2中的所有大写字母转成小写并输出到文件testfile_1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	dd &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;testfile_2 &lt;span class=&#34;nv&#34;&gt;of&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;testfile_1 &lt;span class=&#34;nv&#34;&gt;conv&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ucase
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iostat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# 查看当前Linux系统的IO状态&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	iostat -d -k &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;2常见问题&#34;&gt;2.	常见问题&lt;/h4&gt;
&lt;p&gt;2.1.	linux可用内存足够为什么还用swap
内核参数swappiness的值的大小，决定着linux何时开始使用swap，比如swappiness=60，在内存使用率到40%的时候，开始有交换分区的使用&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/linux/">Linux</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>五种常用消息队列对比</title>
                <link>https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-mq/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E7%AC%94%E8%AE%B0/java-mq/</guid>
                <pubDate>Mon, 29 Jul 2019 21:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对几种常见消息队列MQ（ActiveMQ、Kafka、Pulsar、RocketMQ、RabbitMQ）的实现机制和使用场景进行了总结。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-mq/java-mq.png&#34; alt=&#34;MQ思维导图&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;activemq&#34;&gt;ActiveMQ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;常用操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;获取消息方式
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;推&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;优点
&lt;ul&gt;
&lt;li&gt;可以尽可能快的发送给消费者&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;缺点
&lt;ul&gt;
&lt;li&gt;消费者缓冲区可能溢出&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;拉&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;优点
&lt;ul&gt;
&lt;li&gt;不会造成缓冲区溢出&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;缺点
&lt;ul&gt;
&lt;li&gt;有一点延迟&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;架构&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主从架构&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;劣势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;吞吐量不足&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;kafka&#34;&gt;Kafka&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;背景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;传统的 ActiveMQ 等消息组件处理消息的吞吐能力较弱&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;目标&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;提供高性能、高吞吐量的基础消息组件&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;高吞吐量&lt;/li&gt;
&lt;li&gt;便于横向扩容&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;劣势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不支持JMS协议&lt;/li&gt;
&lt;li&gt;多Topic的时候性能较差
&lt;ul&gt;
&lt;li&gt;如果分区数量过多，会同时对多个分区进行读写，这个时候性能就会不太好&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;一个分区只能有一个消费者&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;应用场景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;日志采集&lt;/li&gt;
&lt;li&gt;实时数据计算&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;核心组件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Broker&lt;/li&gt;
&lt;li&gt;Producer&lt;/li&gt;
&lt;li&gt;Consumer&lt;/li&gt;
&lt;li&gt;ZK&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;底层原理&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;高吞吐量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Topic换分为多个Partition，提高并发度&lt;/li&gt;
&lt;li&gt;充分利用了磁盘顺序读写的性能&lt;/li&gt;
&lt;li&gt;使用Zero-Copy技术
&lt;ul&gt;
&lt;li&gt;直接在内核态进行数据传输，避免拷贝数据导致内核态和用户态的切换&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;数据批量发送&lt;/li&gt;
&lt;li&gt;数据批量压缩&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;高查找效率&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;根据offset为key建立稀疏索引&lt;/li&gt;
&lt;li&gt;稀疏索引可以使得索引文档非常小，但是增加了查找消息的时间&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;常见问题&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如何保证 Exactly-Once？
&lt;ul&gt;
&lt;li&gt;[[配置Kafka Exactly-Once消费的方法]]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;对比&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MQ
&lt;ul&gt;
&lt;li&gt;不支持 JMS 协议&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;pulsar&#34;&gt;Pulsar&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;背景&lt;/li&gt;
&lt;li&gt;核心组件
&lt;ul&gt;
&lt;li&gt;BookKeeper
&lt;ul&gt;
&lt;li&gt;存储消息数据&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Broker
&lt;ul&gt;
&lt;li&gt;生产者和消费者直接和 Broker 进行连接&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;参考：&lt;a href=&#34;https://pulsar.apache.org/docs/next/concepts-architecture-overview/&#34;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;优势
&lt;ul&gt;
&lt;li&gt;支持百万级消息主题&lt;/li&gt;
&lt;li&gt;支持延迟事件&lt;/li&gt;
&lt;li&gt;多样的消费模式
&lt;ul&gt;
&lt;li&gt;Exclusive&lt;/li&gt;
&lt;li&gt;Failover&lt;/li&gt;
&lt;li&gt;Share&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;多样的消息重试&lt;/li&gt;
&lt;li&gt;支持单条提交&lt;/li&gt;
&lt;li&gt;存算分离
&lt;ul&gt;
&lt;li&gt;可扩展能力强
&lt;ul&gt;
&lt;li&gt;如果是存算融合的方式，无论存储和计算出现问题，都需要迁移机器，但存储扩展通常迁移大量数据&lt;/li&gt;
&lt;li&gt;由于与任一给定 Topic 相关的数据都不会与特定存储节点进行捆绑，因此很容易替换存储节点或扩缩容，集群中最小或最慢的节点也不会成为存储或带宽的短板&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;劣势&lt;/li&gt;
&lt;li&gt;底层原理
&lt;ul&gt;
&lt;li&gt;[[Pulsar实现单条提交的方法]]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;应用场景&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;rocketmq&#34;&gt;RocketMQ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;背景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;起源于 Kafka ，但不是 Kafka 的一个拷贝&lt;/li&gt;
&lt;li&gt;Kafka 多 Topic 的时候性能比较差&lt;/li&gt;
&lt;li&gt;对 Kafka 可靠性传输、事务性做了优化&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;核心组件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NameServer&lt;/li&gt;
&lt;li&gt;Broker
&lt;ul&gt;
&lt;li&gt;Master&lt;/li&gt;
&lt;li&gt;Slave&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Producer&lt;/li&gt;
&lt;li&gt;Consumer&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;有线程的管理台界面，便于管理，且可以看到消息的内容&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;支持通过Tag，Message Header，Message Body进行过滤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;便于横向扩展&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数据与索引分开存储&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;同时支持推和拉&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;多Topic的时候性能好&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原因
&lt;ul&gt;
&lt;li&gt;一个Broker共用一个分区，一个分区支持上万队列&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;支持事务发送&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LocalTransactionExecuter&lt;/li&gt;
&lt;li&gt;TransactionCheckListener&lt;/li&gt;
&lt;li&gt;RocketMQ从4.3版本开始支持事务，原理为先预提交消息，然后执行本地事务，执行成功正式commit消息，如果没成功commit，会不断的check，check超时则回退本地事务&lt;/li&gt;
&lt;li&gt;参考：&lt;a href=&#34;https://www.infoq.cn/article/2018/08/rocketmq-4.3-release&#34;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;劣势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;吞吐量没有kafka高&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;底层原理&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;高吞吐量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Topic划分为多个分区，提高并发度&lt;/li&gt;
&lt;li&gt;充分利用磁盘顺序读写的性能&lt;/li&gt;
&lt;li&gt;使用Zero-Copy技术&lt;/li&gt;
&lt;li&gt;直接在内核态进行数据传输，避免拷贝数据导致内核态和用户态的切换&lt;/li&gt;
&lt;li&gt;数据批量发送&lt;/li&gt;
&lt;li&gt;数据批量压缩&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主从同步&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;同步双写&lt;/li&gt;
&lt;li&gt;异步复制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;应用场景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;电商&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;常用操作&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;对比&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;和Kafka的比较
&lt;ul&gt;
&lt;li&gt;吞吐量
&lt;ul&gt;
&lt;li&gt;kafka &amp;gt; rocketmq&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;数据可靠性
&lt;ul&gt;
&lt;li&gt;都支持异步/同步刷盘，但 kafka 同步刷盘的情况下，性能急剧下降&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;顺序消费
&lt;ul&gt;
&lt;li&gt;都支持顺序消费，但 kafka 在节点宕机的情况下不能保证消息的顺序性
&lt;ul&gt;
&lt;li&gt;原因
&lt;ul&gt;
&lt;li&gt;异步复制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;rabbitmq&#34;&gt;RabbitMQ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;优势
&lt;ul&gt;
&lt;li&gt;时延低&lt;/li&gt;
&lt;li&gt;社区比较稳定&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;常识&#34;&gt;常识&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;主要作用&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;异步&lt;/li&gt;
&lt;li&gt;削峰&lt;/li&gt;
&lt;li&gt;解耦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如何保证消息的可靠性？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Broker
&lt;ul&gt;
&lt;li&gt;保证多个 replica 都写入成功了才算写入成功&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;生产者
&lt;ul&gt;
&lt;li&gt;开启失败不断重试&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;消费者
&lt;ul&gt;
&lt;li&gt;不自动提交，消费成功了再自动提交&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如何保证消息消费的幂等性？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据库 upsert&lt;/li&gt;
&lt;li&gt;redis set&lt;/li&gt;
&lt;li&gt;记录到 redis 里面，消费前先查询 redis&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如何处理消息挤压？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;写一个临时消费者用数据库之类的持久化工具存起来&lt;/li&gt;
&lt;li&gt;消费者扩容，如果分区设置相对比较小，对 kafka 没有效果&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mq/">MQ</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/activemq/">ActiveMQ</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/kafka/">Kafka</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/pulsar/">Pulsar</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/rocketmq/">RocketMQ</category>
                                
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/rabbitmq/">RabbitMQ</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Netty</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-netty/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-netty/</guid>
                <pubDate>Sun, 28 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Java中的常用高性能通信组件Netty进行了总结和简要介绍。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-netty/java-netty.png&#34; alt=&#34;Java Netty&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1原理&#34;&gt;1.	原理&lt;/h4&gt;
&lt;p&gt;1.1.	为什么传输快？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用零拷贝技术
减少用户态和内核态的切换
减少copy的动作，应用可以直接操作磁盘或者内存&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.2.	为什么并发高？
使用NIO
IO多路复用&lt;/p&gt;
&lt;p&gt;1.3.	为什么封装好？
责任链模式
事件驱动&lt;/p&gt;
&lt;p&gt;1.4.	如何解决沾包？
1.4.1.	四种解决方法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LineBasedFrameDecoder
用换行符做消息标记&lt;/li&gt;
&lt;li&gt;DelimiterBasedFrameDecoder
指定消息的结束符&lt;/li&gt;
&lt;li&gt;FixedLengthFrameDecoder
定长消息&lt;/li&gt;
&lt;li&gt;LengthFieldBasedFrameDecoder
定义长度字段&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.4.2.	产生原因
应用程序的字节大小大于Socket缓冲区大小，拆包，小于缓冲区大小，沾包
以太网payload &amp;gt; MTC(1500字节)&lt;/p&gt;
&lt;p&gt;1.5.	如何处理epoll空转造成的CPU飙高？
统计Seletor每秒处理的select时间数量，超过限定值则重新注册Selector&lt;/p&gt;
&lt;h4 id=&#34;2组件&#34;&gt;2.	组件&lt;/h4&gt;
&lt;p&gt;2.1.	Channel
Socket连接&lt;/p&gt;
&lt;p&gt;2.2.	EventLoop
一个Channel在一个生命周期内只注册一个EventLoop
EventLoop在生命周期内只和一个Thread绑定
一个EventLoop可能会注册多个Channel&lt;/p&gt;
&lt;p&gt;2.3.	EventLoopGroup
包含多个EventLoop
使用线程池&lt;/p&gt;
&lt;p&gt;2.4.	ChannelFuture
Channel的操作结果&lt;/p&gt;
&lt;p&gt;2.5.	ChannelHandler
数据处理类&lt;/p&gt;
&lt;p&gt;2.6.	ChannelPipeline
数据处理流水线&lt;/p&gt;
&lt;p&gt;2.7.	ByteToMessageDecoder
解码类&lt;/p&gt;
&lt;p&gt;2.8.	MessageToByteEncoder
编码类&lt;/p&gt;
&lt;p&gt;2.9.	ByteBuf
字节容器&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/netty/">Netty</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-内存溢出</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-oom/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-oom/</guid>
                <pubDate>Sat, 27 Jul 2019 10:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;内存溢出一直是Java进阶过程中非常重要的知识点，在面试中也经常被问到有没有在现网解决过内存溢出的问题，本文主要总结了几种常见的内存溢出类型和出现相关内存溢出的原因，最后还提供了一些常用的分析与排查内存溢出的工具和方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-oom/java-oom.png&#34; alt=&#34;OOM思维导图&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;内存溢出分类&#34;&gt;内存溢出分类&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;堆溢出
1、内存溢出（无法申请到内存）
jstat查看内存使用情况，检查堆参数，一般是申请的内存太大，比如一个特别大的byte数组
2、内存泄漏（对象无法回收）
可以使用MAT工具里面的Path to GC Roots定位，一般是一个特大不能回收的对象&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;栈溢出
1、StackOverflowError
方法调用层次太深，内存不够新建栈帧，比如一个没有结束条件的递归
2、OutOfMemoryError
线程太多，内存不够新建线程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MetaSpace数据区溢出
动态生成大量Class&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;本地直接内存溢出
申请一个大的直接内存&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数据超限内存溢出
分配的数据结构在此平台不可寻址&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;排查方法&#34;&gt;排查方法&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;jdk自带命令&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jstat -gcutil 33816 250 20 # 监控jvm的内存使用情况
jps -ml # 输出虚拟机启动时传递给主类main()的参数，输出主类的全名
jmap -F -dump:live,format=b,file=eclipse.bin 85962 # dump堆内存
# 分析方法
# 可以使用VisualVM，主要查看是否存在大对象，然后分析为什么没有被回收
jstack -F -l -m 85962 # 显示虚拟机快照
jstack -l PID &amp;gt;&amp;gt; test.txt
jmap -histo pid # 实时查看JVM对象大小的排序结果，但无法看到对象的具体内容
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;arthas&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 找到最耗CPU的方法
thread -n 5
# 观察方法的返回
watch com.test.MyClass query returnObj
# 反编译类
jad com.test.MyClass
# 监控调用情况
monitor -c 5 com.test.MyClass query
# 查看分段的调用时间
trace com.test.MyClass query
# 查看方法完整的调用链
stack com.test.MyClass query
# 记录调用现场
tt -t com.test.MyClass query
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;参数检查&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;-Xms 初始堆大小
-Xmx 最大堆大小
-Xmn 新生代大小
XX:MaxMetaSpaceSize 元数据区大小
Survivor Eden与Survivor区的大小比值
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/java/">Java</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>常见Java面试题总结</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/ali-interview/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/ali-interview/</guid>
                <pubDate>Sat, 27 Jul 2019 08:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对自己碰到的常见的Java面试题进行了总结以及给出了自己的解答。&lt;/p&gt;
&lt;!--more --&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;讲一讲你对数据库的索引和事务的理解 ?
可参考[[MySQL 数据库常见面试题总结]]进行针对性回答。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;讲一讲你对数据库的乐观锁和悲观锁的理解 ?
可参考[[MySQL数据库常见面试题总结]]进行针对性回答。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Java里面有哪几种类型的锁 ?&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1、synchronized&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;	三个阶段
		偏向锁
			在对象头上的Mark Word部分设置线程ID
		轻量级锁
			轻量级锁依赖CAS操作Mark Word来试图获取锁
		重量级锁
			monitorenter 和 monitorexit
	不可重入锁
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2、ReentrantLock&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;	可重入锁
		基于AQS来实现，首先尝试用CAS(LOCK_IF_MP)来获取锁，如果没有获取到，就加入到FIFO的链表里面，然后锁如果被释放了，通知链表里面的第一个节点获取锁
	提供了Condition用于线程间通信
	提供了tryAcquire方法，用于超时没有获取到锁的处理
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3、ReentrantReadWriteLock&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;	写线程访问时，所有的读和其他写线程都阻塞
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义一个10位的buffer，有一个线程每100ms读一次buffer，有一个线程每1s写一次buffer，要求性能尽可能高，且不能出现脏读和幻读
可利用上面的ReentrantReadWriteLock读写锁来实现，并在buffer定义的时候加上volatile关键字，保证线程的可见性。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;单一接口混合功能和接口功能单一哪个实现上更优？
暂无什么好的想法，个人自由发挥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;消息防疲劳系统怎么设计？
暂无什么好的想法，个人自由发挥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;首字母联想词搜索用什么数据结构比较好？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;根据GC Root确定对象能不能回收的具体机制是什么，到底怎么确定对象之间是否存在引用？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;讲一讲你项目中最大的技术难点是什么？
核心是需要讲好项目中遇到的最大挑战，要从面试官的角度去考虑问题，而不是泛泛的去谈自己整个做事的流程，最主要是说这个技术挑战的缘起是什么，自己怎么考虑的，用什么好方法解决的。
其实可以讲讲我们缓存的设计。怎么设计缓存key的？怎么保证缓存不雪崩，怎么保证高可用，怎么做的缓存预热，怎么保证缓存命中率，怎么保证缓存不穿透，可以从上面这几个方面去讲，说实话自己对整个项目的总结还是有点不够，面对面试官的气场不够强，信心不太足，没有发挥出自己的亮点，其实整个来说我做的这块还是挺有挑战的。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其他&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1.一面主要问基础，包括几方面:

1) collection接口下面有哪些集合，hashmap的实现原理，要把1.7和1.8的区别(红黑树)讲出来，map有哪些实现类以及使用场景，hashmap, hashtable, linkedhashmap,weakHashMap, treemap, concurrentmap，你要是讲的好这里可以说十几分钟，linkedhashmap和treemap排序的区别，concurrenthashmap如何实现线程安全，这里也要把1.7和1.8实现差异说出来(分段加锁和cas技术)，说到这里以后就会问你cas实现原理( CPU Lock前缀指令),它是如何保证其他cpu core的cache失效的，然后会问你volatile的实现原理，要结合java内存模型来讲，可见性是如何实现的(内存屏障)，synchronized锁和reentrantlock的区别以及内部怎么实现的: 常用的gc算法及优缺点，如何判断对象的存活性

2) mysql有哪些索引，底层数据结构是什么，画一下b+树的结构以及数据的插入过程，聚集索引的特点，如何做索引优化，给你一个sql语句select a,b,c from t where a&amp;lt;某个值 and  b&amp;gt;某个值 and c = 1,如何建索引(可以是c,a,b或者c,b, a的联合索引，但要分析什么场景下分别用哪个);结合Innodb的实现说下数据库的隔离级别，分别是怎么解决脏读、不可重复读和幻读取的;对mysql最新版本的同步机制有没有了解,比如一个主节点和多个备份节点,mysql怎么保证可用性和性能；

3) redis有哪些数据结构，分别用在哪些场景,对redis的pipeline有没有了解，解决什么问题,redis采用了什么方式来节省内存

4) Spring IOC的理解以及IOC容器的初始化过程,Spring里的Bean是保存在哪里的,BeanFactory和FactoryBean的区别,Spring AOP怎么实现的(需要讲出来JDK动态代理和CGLib动态代理优缺点),头条还问了如果一个类的某个方法没有在接口里定义,这两种动态代理方式是怎么实现的；

5) 线程池有哪些实现类，ThreadPoolExecutor有哪些参数，讲下它的工作原理，在使用过程中有哪些经验(比如工作队列大小的设置,ThreadFactory和ExjectExcutionHandler)

6) 线程有哪些状态以及怎么转换的

7. 二面主要结合项目来问

1). GC的常用算法以及优缺点，项目中用的什么垃圾回收算法,怎么做GC调优,对G1收集器有没有了解(要说出G1的出现主要解决了什么问题,为什么CMS算法会有内存碎片)

在介绍GC算法的时候可能会提到GC Roots，面试官会问你哪些对象可以作为GC Roots，栈里面的局部变量表里有基本数据类型和引用类型，怎么找到引用类型;有个对象引用比如Hello, hello.sayHello()调用的时候怎么找到类里的sayHello()这个方法

2). 项目里有用到限流，具体怎么做的

3). 看你对Netty有了解，能不能讲下它的工作原理,netty里ChannelInBoundHandler和ChannelOutBoundHandler的区别，netty在读写数据的时候是先调用head还是tail handler,既然你知道NIO，有没有听说

JDK epoll的BUG，Netty是怎么解决的,如何解决TCP粘包和拆包的问题,为什么会出现粘包和拆包

4). 讲下你项目里做的数据库索引优化,如何去分析一条语句的执行性能,explain语句你会关注哪些字段

5). 分别在什么场景使用synchronized和Lock，ReentrantLock内部怎么实现的，多线程通信有哪些方式(要把JUC包下的常用实现类说出来,比如CountDownLatch, 信号量, 栅栏)

6). 如何实现分布式锁,一开始说了redis的实现,redis可能在锁超时后还没执行完任务,这个时候要怎么做，有没有更好的方式,后面说了用zookeeper的实现

7). 项目里有用到ElasticSearch，能介绍ES的工作原理吗,什么是正向索引和反向索引，如何对ES进行优化

8). 为什么会出现大量CLOSE_WAIT连接，能不能画一下TCP挥手的流程图介绍下,后面是怎么解决句柄泄露的问题

9). 写代码实现一个EnumSet(阿里),用数组或者链表实现一个阻塞队列(美团)

10). 哪些场景下会出现内存泄露(可以讲下HashMap,ThreadLocal,WeakHashMap,finalize),会问你ThreadLocal的原理以及为什么会有内存泄露

11). 如何获取Redis里所有的keys(可以先说下keys *命令,然后再介绍可能导致系统阻塞无法对外响应,再介绍更好的scan命令)

12). Java类加载机制，为什么要双亲委派

13). Spring Bean的作用域有哪些，单例是线程安全的吗，怎么保证线程安全

14). Java里的Exception信息是怎么保存的,有没有用到java8的一些特性, Lambda表达式是语法糖吗，怎么实现的，和匿名内部类有什么区别; 

3. 三面,一般是技术总监或者某个部门的主管面

1). 简历里有提到有定位系统响应慢的经验，具体怎么做的

2). 如果有个节点一直在做FullGC，你要怎么快速定位并恢复环境

3). 如果要做一个秒杀系统，你会怎么设计，把能想到的点都说出来

4). 假设数据库里有100W条数据，要把他们全部加载到Redis里，你会怎么设计这个系统(这里可能是个坑,缓存一般保存的热点数据,要讲下分布式缓存、缓存击穿、雪崩、并发更新等问题)

5). ElasticSearch的分片机制,ES搜索过程是如何工作的,如果有很多网卡信息怎么做分片，如果一个Document有2个网卡呢

6). 用过哪些消息中间件,能不能说下Kafka的工作原理，如果保证分布式系统的数据的一致性,给Kafka发消息如何保证消息的幂等性

7). 如何对数据库做分库分表

4. 四面,基本上也是结合项目来问一些知识点,面试官一般会比较强势,会经常打断你说话,给你压力,这个时候千万不要慌,问的问题和上面差不多

你在项目中遇到的最难的一个问题是什么，自己对未来3-5年的一个规划

5. 五面,HR面，随便聊聊
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E9%9D%A2%E8%AF%95/">面试</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-Redis</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-redis/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-redis/</guid>
                <pubDate>Fri, 26 Jul 2019 12:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对Redis的应用场景及其内部实现机制进行了总结，并对在使用Redis过程中可能会遇到的坑给出了针对性的规避措施。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-redis/java-redis.png&#34; alt=&#34;Redis思维导图&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1背景&#34;&gt;1.	背景&lt;/h4&gt;
&lt;p&gt;关系数据库访问数据较慢&lt;/p&gt;
&lt;h4 id=&#34;2目标&#34;&gt;2.	目标&lt;/h4&gt;
&lt;p&gt;提高数据的访问速度&lt;/p&gt;
&lt;h4 id=&#34;3优势&#34;&gt;3.	优势&lt;/h4&gt;
&lt;p&gt;数据访问速度较快&lt;/p&gt;
&lt;h4 id=&#34;4劣势&#34;&gt;4.	劣势&lt;/h4&gt;
&lt;p&gt;数据存放在内存中，容量存在限制&lt;/p&gt;
&lt;h4 id=&#34;5底层原理&#34;&gt;5.	底层原理&lt;/h4&gt;
&lt;p&gt;5.1.	内存数据库&lt;/p&gt;
&lt;p&gt;5.2.	持久化方式&lt;/p&gt;
&lt;p&gt;5.2.1.	RDB&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;介绍
在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，在替换之前的文件，用二进制压缩存储&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优势
适合进行备份
适合进行灾备
对Redis的性能压力比较小
RDB在恢复大数据集的速度比AOF恢复速度要快&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;劣势
RDB有可能会丢失分钟级的数据
如果数据集比较大，且CPU紧张的情况下，Redis停止服务的时间可能会比较长&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;5.2.2.	AOF&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;介绍
以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优势
AOF只会丢失秒级的数据
AOF只进行追加
AOF文件的可读性较好&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;劣势
对于相同的数据集来说，AOF文件的体积通常要大于RDB文件的体积
AOF的速度可能会比RDB慢
AOF可能会拖慢Redis的访问速度&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;5.3.	部署架构&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主从复制&lt;/li&gt;
&lt;li&gt;哨兵&lt;/li&gt;
&lt;li&gt;集群
Master之间分配slots，一共16384个slot
slot不完整，集群失效
每个Master都会有Slave
扩缩容需要手动重新分片
先到其中任何一台执行，没执行成功会将客户端转向正确的节点执行命令
redis提供了命令供管理员自动迁移slots
使用CRC16(KEY) mod 16384的值，决定将key放到哪个槽中
去中心化设计，每个节点都是对等的，保存全量的元数据信息&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;6应用场景&#34;&gt;6.	应用场景&lt;/h4&gt;
&lt;p&gt;查多写少
热点数据
不适合存储持久化数据&lt;/p&gt;
&lt;h4 id=&#34;7底层原理&#34;&gt;7.	底层原理&lt;/h4&gt;
&lt;p&gt;7.1.	底层数据结构&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;String
embstr
SDS
len，free
redisObject&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HMap
1、hashtable
元素比较多时
2、ziplist
适用于元素较小时
key和value都被推到队尾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;List
1、ziplist
使用连续空间，节省空间，但只能保存小整数或者小字符串
ziplist如何压缩空间
小数字和大数字不一样，小数子只用一个字节存储
不需要前后指针
2、linkedlist
双端链表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set
1、inset
inset编码的集合对象使用整数集合作底层实现，集合对象包含所有元素都会被保存在整数集合里面
2、hashtable&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SortedSet
1、skiplist
使用ZRANGE和ZREVERANGE比较多
内存占用不多
实现比较简单
&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-redis/redis-skiplist.png&#34; alt=&#34;跳表示意图&#34;&gt;
2、ziplist&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HyperLogLog
统计元素数量&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GEO
地理位置&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.2.	一致性Hash&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;背景
取模的方式扩缩容的时候对缓存命中率的影响比较大&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;原理
将整个hash值空间组织成一个虚拟的圆环
1、扩容
只影响添加节点后面的节点（顺时针）
2、缩容
只影响删除节点后面的数据（顺时针）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;问题1
描述
当节点较少的时候，容易因为节点分布不均匀，产生缓存热点的问题
1、解决方法
使用虚拟节点，改善一致性Hash的问题
2、具体实现
&lt;a href=&#34;https://www.cnblogs.com/snowwhite/p/9672185.html&#34;&gt;https://www.cnblogs.com/snowwhite/p/9672185.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.3.	过期策略&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定期删除
默认是每隔100ms就随机抽取一些一些设置了过期的key
如果此时key已经过期，就删除，不会返回任何东西&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;惰性删除
放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键，如果没有过期，就返回该键&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定时删除
从设置key的过期时间开始，就启动一个定时器，到时间就删除该key
对内存比较友好，但浪费CPU资源&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.4.	复制原理
slave第一次连接或者重连，会触发一次全量同步
主节点做一个bgsave，同时将后续修改操作记录到内存buffer，如果buffer超过限定的值，则复制失败。待完成后将rdb文件全量同步到复制节点，复制节点接受完成后将rdb镜像加载到内存，加载完成后，再通知主节点将期间修改的操作记录同步到复制节点进行重放就完成了同步过程
后续Master手机到的写命令都会通过之前建立的连接，增量发送给slave端
slave执行buffer中的命令
slave异步方式执行同步&lt;/p&gt;
&lt;p&gt;7.5.	复制时机&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;全量复制
slave首次启动或重启
slave不满足部分复制的条件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;部分复制
主从的redis版本 &amp;gt;= 2.8
slave只是掉线
slave保存的run id与master当前run id一致
slave掉线期间，master保存在内存的offset可用&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.6.	数据丢失&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;异步复制导致的数据丢失
Master突然宕机，Slave有些数据还没有同步过来&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;脑裂导致的数据丢失
发生主从切换，但是客户端还在往Master写入数据&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.7.	事务&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ACID
1、原子性
2、持久性
AOF在总是SYNC的模式下，因为主线程不会阻塞到写入完成，所以不能保证持久性
RDB的情况下，事务执行完成后，服务器可能在RDB未更新之前失败，所以也不可能保证持久性
3、隔离性
4、一致性&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用方法
WATCH
MULTI
EXEC&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7.8.	过期算法
ttl
lru
random&lt;/p&gt;
&lt;h4 id=&#34;8对比&#34;&gt;8.	对比&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MongoDB
非关系数据库
非内存数据库&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Memcached
内存数据库
支持的数据结构较少
不能持久化&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;9客户端驱动&#34;&gt;9.	客户端驱动&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Jedis
偏数据库驱动，API提供了比较全面的Redis命令的支持
高性能，分布式特性和丰富的结构，让使用者能够将精力更集中地放在处理业务逻辑上&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisson
底层原理
使用Netty作为通信组件
将一些操作组合成Script实现特定的功能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;问题
MapCache有内存溢出风险
在编解码失败的时候可能会造成某些命令执行时间过长&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;10相关问题&#34;&gt;10.	相关问题&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;缓存命中率&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存穿透
解决方法
缓存预热&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存雪崩
解决方法
使用高可用架构
服务降级，使用本地缓存&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缓存击穿
解决方法
让key不在一个时间段集中失效，加或减一个随机值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为什么使用单线程
CPU不是瓶颈点，IO是瓶颈点，单线程够用也简单&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;redis集群做迁移的时候怎么查找数据？
单个key迁移的过程中会阻塞，所以如果没找到key会重新ask一遍&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;常用命令&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;scan 176 MATCH *11* COUNT 1000
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;11常见优化&#34;&gt;11.	常见优化&lt;/h4&gt;
&lt;p&gt;Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件
如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次
为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内
尽量避免在压力很大的主库增加从库
主从复制不要用图状结构，用单向链表结构更为稳定，即：Master &amp;lt; Slave1 &amp;lt; Slave2 ...&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/redis/">Redis</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>MySQL 数据库常见面试题总结</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93/</guid>
                <pubDate>Thu, 25 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;MySQL是现阶段最流行的关系型数据库，也是后台开发面试过程中必问的知识点，本文主要对面试中经常出现的MySQL事务、锁和索引进行了总结，基本可以覆盖到面试过程中和MySQL相关的90%以上的知识点。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-mysql/java-mysql.png&#34; alt=&#34;MySQL&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;乐观锁和悲观锁&#34;&gt;乐观锁和悲观锁&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;乐观锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;出发点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;认为数据一般情况下不会造成冲突&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;并发好效率高&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缺点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ABA问题
&lt;ul&gt;
&lt;li&gt;解决方法
&lt;ul&gt;
&lt;li&gt;版本号&lt;/li&gt;
&lt;li&gt;时间戳&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用场景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;读多写少，数据冲突不大的情况，考虑用户积分加减的场景&lt;/li&gt;
&lt;li&gt;因为如果冲突比较大，事务需要回滚，应用层也会不断重试，这样反倒降低的性能&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SQL&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;update table set name = &#39;Aron&#39;, version = version + 1 where id = #{id} and version = #{version};&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先不上锁，但如果SQL执行失败应用层需要自己处理，比如重试&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;悲观锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;出发点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;认为数据比较大可能会发生冲突&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用场景&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据冲突比较大的情况&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SQL&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;select ... id=1 for update&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;索引&#34;&gt;索引&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;类别&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;普通索引&lt;/li&gt;
&lt;li&gt;唯一索引&lt;/li&gt;
&lt;li&gt;主键索引&lt;/li&gt;
&lt;li&gt;全文索引&lt;/li&gt;
&lt;li&gt;组合索引&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;实现机制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;B+树&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-mysql/mysql-b+.png&#34; alt=&#34;B+树结构&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SQL执行计划&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过SQL分析工具&lt;/li&gt;
&lt;li&gt;Explain&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;什么情况下会失效&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用or关键字&lt;/li&gt;
&lt;li&gt;like的模糊查询以%开头&lt;/li&gt;
&lt;li&gt;组合索引使用的不是第一部分&lt;/li&gt;
&lt;li&gt;列类型是字符串，但是查询条件中没有使用&amp;quot;&amp;quot;&lt;/li&gt;
&lt;li&gt;MySQL内部机制认为不使用比使用快的其他情况&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;sql&#34;&gt;SQL&lt;/h1&gt;
&lt;h1 id=&#34;架构&#34;&gt;架构&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Server层&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;连接器&lt;/li&gt;
&lt;li&gt;分析器&lt;/li&gt;
&lt;li&gt;优化器&lt;/li&gt;
&lt;li&gt;执行器&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;存储层&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;binlog&#34;&gt;binlog&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;statment&lt;/li&gt;
&lt;li&gt;mixed&lt;/li&gt;
&lt;li&gt;row&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;分库分表&#34;&gt;分库分表&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;如何在线迁移？
&lt;ul&gt;
&lt;li&gt;双写，批量插入转移，如果有冲突一条一条写入，写入的时候先查询再写入
有校验脚本来检查迁移是否成功&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;常见问题&#34;&gt;常见问题&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;如何优化分页查询？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大数据量的时候限制用户只能一页一页的往后翻&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可靠性实现？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;redolog&lt;/li&gt;
&lt;li&gt;binlog&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;事务的可重复读是如何实现的？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;给每行增加两个隐藏字段来实现MVVC(数据多版本并发控制)，两个列都用来存储事务的版本号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;每开启一个新事务，事务的版本号就会递增&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果数据的trx_id落在低水位，可见&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果数据的trx_id落在高水位，不可见&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果数据在黄色区间，活跃事务ID数组&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;trx_id在数组中，说明未提交，不可见&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;trx_id不在数组中，说明已提交，可见&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;读提交和可重复读实现区别？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可重复读在事务开始的时候创建一致性视图&lt;/li&gt;
&lt;li&gt;读提交在语句执行的时候创建一致性试图&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQL如何保证数据不丢失？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;两阶段提交，先prepare，后commit&lt;/li&gt;
&lt;li&gt;prepare其实做的一件事情就是刷盘&lt;/li&gt;
&lt;li&gt;如果存在完整的prepare&lt;/li&gt;
&lt;li&gt;如果binlog完整，则提交&lt;/li&gt;
&lt;li&gt;可以保证数据和binlog的一致性&lt;/li&gt;
&lt;li&gt;如果不完整，则回退&lt;/li&gt;
&lt;li&gt;如果commit已经刷盘，则直接提交&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAM和InnoDB的区别？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MyISAM不支持事务&lt;/li&gt;
&lt;li&gt;MyISAM不支持行锁&lt;/li&gt;
&lt;li&gt;MyISAM支持FULLTEXT全文索引&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;count(*) count(1) count(col)的区别？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;count(*) = count(1), 统计行不会忽略NULL&lt;/li&gt;
&lt;li&gt;count(col), 统计行会忽略col=NULL的行&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可重复读隔离级别下，MVVC在数据的CRUD层面分别是如何实现的？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SELECT
&lt;ul&gt;
&lt;li&gt;读取创建版本小于或等于当前事务版本号，并且删除版本为空或大于当前事务版本号的记录。这样可以保证在读取之前记录是存在的&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;INSERT
&lt;ul&gt;
&lt;li&gt;将当前事务的版本号保存至行的创建版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;UPDATE
&lt;ul&gt;
&lt;li&gt;新插入一行，并以当前事务的版本号作为新行的创建版本号，同时将原记录行的删除版本号设置为当前事务版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DELETE
&lt;ul&gt;
&lt;li&gt;将当前事务的版本号保存至行的删除版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;数据库锁&#34;&gt;数据库锁&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;全局锁&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;表级锁&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tables&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;行锁&lt;/li&gt;
&lt;li&gt;S锁&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;share&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;X锁&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;都是针对索引加锁，如果索引失效，会升级为表锁
如果索引没命中，会退化成间隙锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;间隙锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;select * from emp where empid &amp;gt; 100 for update;&lt;/li&gt;
&lt;li&gt;间隙锁之间不会冲突，所以容易造成死锁&lt;/li&gt;
&lt;li&gt;原则
&lt;ul&gt;
&lt;li&gt;向左右查找第一个不满足条件的索引&lt;/li&gt;
&lt;li&gt;当使用唯一索引的时候，如果等值刚好命中，不用向左右遍历找到不满足条件的索引&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;作用
&lt;ul&gt;
&lt;li&gt;解决幻读的问题&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;意向锁&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;作用
&lt;ul&gt;
&lt;li&gt;解决上表锁的时候性能不够的问题，没有意向锁可能会一个一个判断行锁&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;原则
&lt;ul&gt;
&lt;li&gt;只与表锁可能有互斥，不会与行锁进行比较&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;分布式事务&#34;&gt;分布式事务&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;TCC&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;柔性事务&lt;/li&gt;
&lt;li&gt;最终一致性&lt;/li&gt;
&lt;li&gt;作用在服务层&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TXC&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;分布式应用里面，多条数据库记录被同时修改带来的一致性问题&lt;/li&gt;
&lt;li&gt;fascar&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;XA&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;作用在资源层，依赖于数据库对XA协议的支持&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;同步机制&#34;&gt;同步机制&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;备库执行 change master 命令&lt;/li&gt;
&lt;li&gt;备库执行 start slave 命令，会启动两个线程 io_thread 和 sql_thread，其中 io_thread 负责与主-库建立连接&lt;/li&gt;
&lt;li&gt;主库将备库要读取的 binlog 发给备库，备库保存为 relay log&lt;/li&gt;
&lt;li&gt;备库读取 relay log 并执行&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mysql/">MySQL</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-垃圾回收</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-gc/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-gc/</guid>
                <pubDate>Wed, 24 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要对JVM的垃圾回收算法和垃圾收集器的实现机制和使用场景进行了总结。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-gc/java-gc.png&#34; alt=&#34;Java GC&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;对象生命周期&#34;&gt;对象生命周期&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;引用计数法
无法解决循环引用的问题&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可达性分析算法
从GC Roots看对象是否可达：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;虚拟机栈（栈中的本地变量表）中引用的对象
本地方法栈中JNI（即Native方法）引用的对象
方法区中类静态属性的变量
方法区中常量引用的变量
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;引用&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;强引用
只要强引用存在就不会回收&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;软引用
只有内存不够才会回收
浏览器的后退按钮&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;弱引用
不管内存够不够都会回收&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;虚引用
作为回收对象时的通知
回收方法区&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;废弃常量&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;无用的类
大量反射、动态代理、CGLib频繁自定义的ClassLoader
需要有类的卸载功能
通过更换ClassLoader实现类的卸载&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;垃圾回收算法&#34;&gt;垃圾回收算法&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;标记-清除算法&lt;/strong&gt;
效率和内存碎片的问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;复制算法&lt;/strong&gt;
分区复制回收
适用于对象存活率较低的场景（新生代）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标记-整理算法&lt;/strong&gt;
标记-清除-整理
使用与对象存活率较高的场景（老生代）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;分代收集算法&lt;/strong&gt;
根据对象存活周期分为几块&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;新生代
复制算法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;老生代
标记-清除算法
标记-整理算法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;垃圾收集器&#34;&gt;垃圾收集器&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Serial收集器&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;缺点
单线程处理，需要暂停其他所有线程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;优点
简单&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ParNew收集器&lt;/strong&gt;
Serial收集器的多线程实现&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Parallel Scavenge收集器&lt;/strong&gt;
以吞吐量为目标
吞吐量=用户代码运行时间/（用户代码运行时间 + GC时间）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Serial Old收集器&lt;/strong&gt;
Serial收集器的老年代版本&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Parallel Old收集器&lt;/strong&gt;
Parallel Scavenge收集器的老年代版本&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CMS收集器&lt;/strong&gt;
以获取最短停顿时间为目标
分为初始标记、并发标记、重新标记、并发清除四个阶段&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;优点
停顿时间短&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;缺点
消耗较多的CPU资源
会产生较多的内存碎片&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为什么需要STP？
处理起来简单，不用管并发的问题&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;G1收集器&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特点
更少的GC停顿时间
可预测的GC停顿时间
不牺牲过多的吞吐量
不需要过多的堆内存&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/gc/">GC</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>程序员知识图谱-计算机网络</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-network/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-network/</guid>
                <pubDate>Tue, 23 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;计算机网络是科班出身的程序员必学的课程之一，这篇文章主要是对TCP/IP网络的四层架构和相关协议进行了简要的总结和介绍。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/hunterzhang86/blog_markdown_files/master/images/java-network/java-network.png&#34; alt=&#34;计算机网络思维导图&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们现在基于TCP/IP的网络一般划分为四层：&lt;/p&gt;
&lt;h5 id=&#34;1应用层&#34;&gt;1、应用层&lt;/h5&gt;
&lt;p&gt;典型的应用层协议包括http/https、ftp/sftp、ssh协议，作为一个Java程序员，可能更多的需要关注的是我们最常用的http/https协议，这个和我们的工作息息相关。&lt;/p&gt;
&lt;p&gt;Http是一个单向的协议，只能由客户端向服务端发送请求，不能由服务端向客户端发送请求，所以如果某些场景下需要服务端向客户端推送消息（比如告警监控页面），现在的Http协议就受到了很大的限制，现在大概有三种方式去实现客户端推送的方式。&lt;/p&gt;
&lt;p&gt;(1)简易轮询
这是最简单暴力的方法，客户端定时轮询，这种方法最大的好处是实现简单，但是如果客户端较多，服务端的压力会很大。&lt;/p&gt;
&lt;p&gt;(2)long-polling
为了解决定时轮询里面服务端压力比较大的问题，也可以使用long-polling来实现从推送数据，简单来说，就是服务端先hold住客户端发送过来的请求，直到服务端的数据有变化才返回，配置中心Apollo里面就是用的这种方式实现配置的推送。&lt;/p&gt;
&lt;p&gt;(3)websocket
区别于简易轮询和long-polling，websocket没有在http协议上做文章，直接实现了一套新的全双工的消息交互协议，客户端既可以向服务端发送消息内容，服务端也可以向服务端发送消息内容，相对简易轮询和long-polling来说实现较为复杂。&lt;/p&gt;
&lt;h5 id=&#34;2传输层&#34;&gt;2、传输层&lt;/h5&gt;
&lt;p&gt;典型的传输层协议包括TCP、UDP协议，重点要关注的是TCP的三次握手，四次挥手，具体的交互请看思维导图。&lt;/p&gt;
&lt;h5 id=&#34;3网络层&#34;&gt;3、网络层&lt;/h5&gt;
&lt;p&gt;典型的网络层协议包括IP和ICMP协议。&lt;/p&gt;
&lt;h5 id=&#34;4数据链路层&#34;&gt;4、数据链路层&lt;/h5&gt;
&lt;p&gt;典型的数据链路层协议包括ARP和RARP协议。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%BD%91%E7%BB%9C/">网络</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>通过Ngrok实现内网穿透</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-ngrok/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-ngrok/</guid>
                <pubDate>Mon, 22 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍如何通过Ngrok实现内网穿透。&lt;/p&gt;
&lt;!--more --&gt;
&lt;h4 id=&#34;安装服务端&#34;&gt;安装服务端&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt-get install build-essential golang mercurial git
git clone https://github.com/inconshreveable/ngrok.git ngrok
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#ngrok.ihunter.me为自己的域名
NGROK_DOMAIN=&amp;#34;ngrok.ihunter.me&amp;#34;

openssl genrsa -out base.key 2048
openssl req -new -x509 -nodes -key base.key -days 10000 -subj &amp;#34;/CN=$NGROK_DOMAIN&amp;#34; -out base.pem
openssl genrsa -out server.key 2048
openssl req -new -key server.key -subj &amp;#34;/CN=$NGROK_DOMAIN&amp;#34; -out server.csr
openssl x509 -req -in server.csr -CA base.pem -CAkey base.key -CAcreateserial -days 10000 -out server.crt

cp base.pem assets/client/tls/ngrokroot.crt
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo make release-server release-client
sudo ./bin/ngrokd -tlsKey=server.key -tlsCrt=server.crt -domain=&amp;#34;ngrok.ihunter.me&amp;#34; -httpAddr=&amp;#34;:8081&amp;#34; -httpsAddr=&amp;#34;:8082&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在域名服务中配置域名转发的当前的VPS&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试连接
现在可以通过http://ngrok.ihunter.me:8081和http://ngrok.ihunter.me:8082就可以访问到ngrok提供的转发服务
为了使用方便，建议把域名泛解析到 VPS 上，这样能方便地使用不同子域转发不同的本地服务。
可以看到这样一行提示&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Tunnel lishanlei.cn:8081 not found　　
　这样子说明万事具备，只差客户端进行连接了
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;安装客户端&#34;&gt;安装客户端&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt-get install build-essential golang mercurial git

git clone https://github.com/inconshreveable/ngrok.git ngrok

sudo make release-client

./ngrok -subdomain pub -proto=http -config=ngrok.cfg 80
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后使用pub.ngrok.ihunter.me:8081访问就可以了&lt;/p&gt;
&lt;p&gt;参考&lt;a href=&#34;https://blog.csdn.net/lishanleilixin/article/details/78384848&#34;&gt;https://blog.csdn.net/lishanleilixin/article/details/78384848&lt;/a&gt;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/linux/">Linux</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/ngrok/">Ngrok</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>在Debian上搭建FTP服务器</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-ftp-indebian/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-ftp-indebian/</guid>
                <pubDate>Sun, 21 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍了在Debian上搭建FTP服务器的方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt install vsftpd
sudo vi /etc/vsftpd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;/etc/vsftpd.conf具体的配置如下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# Example config file /etc/vsftpd.conf
#
# The default compiled in settings are fairly paranoid. This sample file
# loosens things up a bit, to make the ftp daemon more usable.
# Please see vsftpd.conf.5 for all compiled in defaults.
#
# READ THIS: This example file is NOT an exhaustive list of vsftpd options.
# Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&amp;#39;s
# capabilities.
#
#
# Run standalone?  vsftpd can run either from an inetd or as a standalone
# daemon started from an initscript.
listen=NO
#
# This directive enables listening on IPv6 sockets. By default, listening
# on the IPv6 &amp;#34;any&amp;#34; address (::) will accept connections from both IPv6
# and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6
# sockets. If you want that (perhaps because you want to listen on specific
# addresses) then you must run two copies of vsftpd with two configuration
# files.
listen_ipv6=YES
#
# Allow anonymous FTP? (Disabled by default).
anonymous_enable=NO
#
# Uncomment this to allow local users to log in.
local_enable=YES
#
# Uncomment this to enable any form of FTP write command.
write_enable=YES
#
# Default umask for local users is 077. You may wish to change this to 022,
# if your users expect that (022 is used by most other ftpd&amp;#39;s)
#local_umask=022
#
# Uncomment this to allow the anonymous FTP user to upload files. This only
# has an effect if the above global write enable is activated. Also, you will
# obviously need to create a directory writable by the FTP user.
#anon_upload_enable=YES
#
# Uncomment this if you want the anonymous FTP user to be able to create
# new directories.
#anon_mkdir_write_enable=YES
#
# Activate directory messages - messages given to remote users when they
# go into a certain directory.
dirmessage_enable=YES
#
# If enabled, vsftpd will display directory listings with the time
# in  your  local  time  zone.  The default is to display GMT. The
# times returned by the MDTM FTP command are also affected by this
# option.
use_localtime=YES
#
# Activate logging of uploads/downloads.
xferlog_enable=YES
#
# Make sure PORT transfer connections originate from port 20 (ftp-data).
connect_from_port_20=YES
#
# If you want, you can arrange for uploaded anonymous files to be owned by
# a different user. Note! Using &amp;#34;root&amp;#34; for uploaded files is not
# recommended!
#chown_uploads=YES
#chown_username=whoever
#
# You may override where the log file goes if you like. The default is shown
# below.
#xferlog_file=/var/log/vsftpd.log
#
# If you want, you can have your log file in standard ftpd xferlog format.
# Note that the default log file location is /var/log/xferlog in this case.
#xferlog_std_format=YES
#
# You may change the default value for timing out an idle session.
#idle_session_timeout=600
#
# You may change the default value for timing out a data connection.
#data_connection_timeout=120
#
# It is recommended that you define on your system a unique user which the
# ftp server can use as a totally isolated and unprivileged user.
#nopriv_user=ftpsecure
#
# Enable this and the server will recognise asynchronous ABOR requests. Not
# recommended for security (the code is non-trivial). Not enabling it,
# however, may confuse older FTP clients.
#async_abor_enable=YES
#
# By default the server will pretend to allow ASCII mode but in fact ignore
# the request. Turn on the below options to have the server actually do ASCII
# mangling on files when in ASCII mode.
# Beware that on some FTP servers, ASCII support allows a denial of service
# attack (DoS) via the command &amp;#34;SIZE /big/file&amp;#34; in ASCII mode. vsftpd
# predicted this attack and has always been safe, reporting the size of the
# raw file.
# ASCII mangling is a horrible feature of the protocol.
#ascii_upload_enable=YES
#ascii_download_enable=YES
#
# You may fully customise the login banner string:
#ftpd_banner=Welcome to blah FTP service.
#
# You may specify a file of disallowed anonymous e-mail addresses. Apparently
# useful for combatting certain DoS attacks.
#deny_email_enable=YES
# (default follows)
#banned_email_file=/etc/vsftpd.banned_emails
#
# You may restrict local users to their home directories.  See the FAQ for
# the possible risks in this before using chroot_local_user or
# chroot_list_enable below.
#chroot_local_user=YES
#
# You may specify an explicit list of local users to chroot() to their home
# directory. If chroot_local_user is YES, then this list becomes a list of
# users to NOT chroot().
# (Warning! chroot&amp;#39;ing can be very dangerous. If using chroot, make sure that
# the user does not have write access to the top level directory within the
# chroot)
chroot_local_user=YES
chroot_list_enable=YES
user_sub_token=$USER
local_root=/home/$USER/ftp
allow_writeable_chroot=YES
# (default follows)
chroot_list_file=/etc/vsftpd.chroot_list
#
# You may activate the &amp;#34;-R&amp;#34; option to the builtin ls. This is disabled by
# default to avoid remote users being able to cause excessive I/O on large
# sites. However, some broken FTP clients such as &amp;#34;ncftp&amp;#34; and &amp;#34;mirror&amp;#34; assume
# the presence of the &amp;#34;-R&amp;#34; option, so there is a strong case for enabling it.
#ls_recurse_enable=YES
#
# Customization
#
# Some of vsftpd&amp;#39;s settings don&amp;#39;t fit the filesystem layout by
# default.
#
# This option should be the name of a directory which is empty.  Also, the
# directory should not be writable by the ftp user. This directory is used
# as a secure chroot() jail at times vsftpd does not require filesystem
# access.
secure_chroot_dir=/var/run/vsftpd/empty
#
# This string is the name of the PAM service vsftpd will use.
pam_service_name=vsftpd
#
# This option specifies the location of the RSA certificate to use for SSL
# encrypted connections.
rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
ssl_enable=YES

#
# Uncomment this to indicate that vsftpd use a utf8 filesystem.
utf8_filesystem=YES
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改/etc/vsftpd.chroot_list&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo vi /etc/vsftpd.chroot_list
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启FTP服务&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl start vsftpd 或 service vsftpd start
systemctl restart vsftpd 或 service vsftpd restart
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/ftp/">FTP</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>如何将一台老电脑改造为docker服务器</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-linux-in-old-computer/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-linux-in-old-computer/</guid>
                <pubDate>Sat, 20 Jul 2019 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍如何将一台老电脑改造为docker服务器。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、安装deepin系统
首先用refus将deepin制作成系统启动盘，然后重启启动安装deepin到事先划分好的磁盘即可&lt;/p&gt;
&lt;p&gt;2、修改为网易的数据源&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo vi /etc/apt/sources.list
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3、安装docker&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt update &amp;amp;&amp;amp; apt upgrade
curl -fsSL get.docker.com -o get-docker.sh
sudo sh get-docker.sh --mirror Aliyun
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4、修改docker的镜像源&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/etc/docker/daemon.json
{
    &amp;#34;registry-mirrors&amp;#34;: [&amp;#34;https://registry.docker-cn.com&amp;#34;,&amp;#34;http://hub-mirror.c.163.com&amp;#34;]
}

sudo systemctl restart docker
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;5、安装mysql&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo docker run -p 3306:3306 --name mymysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;6、启动mysql&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo docker start mymysql
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/linux/">Linux</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/docker/">Docker</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Windows下配置Hexo博客的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/config-hexo-in-windows/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/config-hexo-in-windows/</guid>
                <pubDate>Sun, 23 Sep 2018 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了在Windows下如何配置Hexo博客。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、配置github
2、安装Node.JS
3、安装Hexo
(1)指定npm的镜像&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;npm install -g cnpm --registry=https://registry.npm.taobao.org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(2)安装hexo&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cnpm install hexo-cli -g
cnpm install hexo --save
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(3)cd到博客文件夹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd &amp;lt;folder&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(4)初始化hexo&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hexo init 
cnpm install
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3、配置Hexo
(1)配置_config.yml文件
将_config.yml文件的deploy项修改为类似如下内容：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;deploy:
  type: git
  repository: git@github.com:hunterzhang86/hunterzhang86.github.io.git
  branch: master
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;_config.yml文件中的title/keywords/author也根据实际情况逐一修改
(2)配置CNAME文件
在source目录下新增CNAME文件，里面的内容填写为自己的域名（如www.ihunter.me），如果没有域名可跳过该步骤&lt;/p&gt;
&lt;p&gt;4、新建md文件生成博客并提交到github
(1)在source/_posts目录下新建一个md文件&lt;/p&gt;
&lt;p&gt;(2)生成博客&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hexo c
hexo g
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(3)提交博客&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hexo d
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;FAQ
1、如何卸载hexo ?&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cnpm uninstall hexo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2、如何使用hunter主题&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/hunterzhang86/hunter.git themes/hunter
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改博客根目录下的配置文件 _config.yml，把theme的值修改为 hunter.&lt;/p&gt;
&lt;p&gt;3、升级到hexo 3.0后deploy出现 error deployer not found:git 错误
执行以下命令安装插件即可&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cnpm install hexo-deployer-git --save
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4、使用hexo 3.0后deploy出现 fatal: Not a git repository (or any of the parent directories) 错误
原因是hexo默认是以项目根目录下的.deploy_git作为git仓库，所以我们得把这个仓库与线上的xxx.github.io仓库绑定，如果绑定过其它目录下的仓库，可以直接把隐藏目录.git复制到.deploy_git目录下。&lt;/p&gt;
&lt;p&gt;5、如何初始化gitment评论系统
首先需要在git上添加一个repo，然后需要在OAuth Apps里面添加应用权限授予我们的个人网站，具体可参考 &lt;a href=&#34;https://zonghongyan.github.io/2017/06/29/201706292034/&#34;&gt;Hexo博客框架下Gitment取代多说评论&lt;/a&gt; 和 &lt;a href=&#34;https://sogrey.github.io/article/Hexo-%E6%B7%BB%E5%8A%A0-Gitment-%E8%AF%84%E8%AE%BA/&#34;&gt;https://sogrey.github.io/article/Hexo-%E6%B7%BB%E5%8A%A0-Gitment-%E8%AF%84%E8%AE%BA/&lt;/a&gt;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/hexo/">Hexo</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>使用Redis实现实时展示页面访问量排名的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/get_topn_count_with_redis/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/get_topn_count_with_redis/</guid>
                <pubDate>Sun, 23 Sep 2018 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍了一种使用Redis实现实时展示页面访问量排名的方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;&lt;strong&gt;update in 2019.7.26&lt;/strong&gt;
其实这种topn的需求使用大数据实时处理框架Spark/Flink会比较好，Spark/Flink可以先将TopN的数据先计算出来然后再持久化到Redis，这样Redis需要保存的数据量会大大减少，避免原来的方案在高并发的情况下可能会直接将Redis写宕机的风险。&lt;/p&gt;
&lt;h5 id=&#34;为什么使用redis存储实时统计的数据&#34;&gt;为什么使用redis存储实时统计的数据？&lt;/h5&gt;
&lt;p&gt;1、实时统计的数据属于查多写少的类型
2、Redis的SortedSet数据结构天然可以非常快的得出topn的数据&lt;/p&gt;
&lt;h5 id=&#34;如何使用redis存储spark的实时统计数据&#34;&gt;如何使用redis存储Spark的实时统计数据？&lt;/h5&gt;
&lt;p&gt;1、考虑到Spark直接操作Redis的话，各个组件之间的耦合会比较严重，所以我们将Spark的实时统计数据先推到kafka里面，然后不断的取出kafka的数据插入到redis中。&lt;/p&gt;
&lt;p&gt;2、进一步的，如果把所有的统计结果都放到redis里面的话，由于数据量比较大可能会对redis的性能有比较大的压力，而实际上我们需要查看的统计结果是有限的，所以只需要将topn的数据存放的redis中即可，可以根据当前的实时数据统计情况，设置插入的阈值，从而减少redis的性能压力。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#取出当前排名1k的统计值，获取当前插入数据的阈值
ZREVRANGE title_count 1000 1000 WITHSCORES
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;如何删除超时的统计数据&#34;&gt;如何删除超时的统计数据？&lt;/h5&gt;
&lt;p&gt;既然是实时的统计数据，如果没有删除超时数据的机制，统计的结果实时上就变成了历史单位时间段的排名了，所以需要定时删除超时的统计数据。&lt;/p&gt;
&lt;p&gt;但其实redis中SortedSet中的子元素是不能设置超时时间的，所以我们使用了另外一个SortedSet来存储子元素的插入时间，然后定时去扫描有没有子元素已经超时，超时的子元素集会在原始的统计表中被清理掉。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#查询超时的元素集，其中1534562250为超时的时间戳阈值
ZREVRANGEBYSCORE title_count_ttl 0 1534562250
#删除超时的元素集
ZREM title_count baidu.com bing.com
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;总结&#34;&gt;总结&lt;/h5&gt;
&lt;p&gt;整个方案在删除超时统计数据上还是有一些瑕疵，毕竟这个SortedSet TTL的实现方案需要插入两次数据，如果朋友们有更好的解决方案欢迎一起讨论，谢谢。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/redis/">Redis</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>HBase常用命令</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/hbase-example/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/hbase-example/</guid>
                <pubDate>Sat, 07 Jul 2018 20:11:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文对HBase常用的一些命令进行了总结。&lt;/p&gt;
&lt;!--more --&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;查看有哪些表
list&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看HBase的状态
status&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建表
create_namespace &#39;sogou&#39;
create &#39;sogou:search_detail&#39;, {NAME =&amp;gt; &#39;detail&#39;},  {NAME =&amp;gt; &#39;detail2&#39;}&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看表的结构
describe &#39;sogou:search_detail&#39;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;删除表
disable &#39;sogou:search_detail&#39;
drop &#39;sogou:search_detail&#39;
说明： 删除表之前必须disable表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;删除表中所有数据
truncate &#39;sogou:search_detail&#39;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;修改表的结构
alter &#39;sogou:search_detail&#39;, {NAME =&amp;gt; &#39;detail&#39;, TTL =&amp;gt; &#39;1024&#39;},  {NAME =&amp;gt; &#39;detail2&#39;, METHOD =&amp;gt; &#39;delete&#39;}&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;新增数据
put &#39;sogou:search_detail&#39;, &#39;rowKey001&#39;, &#39;detail:title&#39;, &#39;陋习&#39;, &#39;detail:retOrder&#39;, &#39;2&#39;, &#39;detail:cliOrder&#39;, &#39;1&#39;, &#39;detail:url&#39;, &#39;www.ihunter.me&#39;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询单条数据
get &#39;sogou:search_detail&#39; &#39;rowKey001&#39;
get &#39;sogou:search_detail&#39;, &#39;rowKey001&#39;, &#39;detail:title&#39;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询多条数据
scan &#39;sogou:search_detail&#39;, {LIMIT =&amp;gt; 10}&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;统计表中数据的行数
count &#39;sogou:search_detail&#39; {INTERVAL =&amp;gt; 100, CACHE =&amp;gt; 500}&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;删除数据
delete &#39;sogou:search_detail&#39;, &#39;rowKey001&#39;, &#39;detail:title&#39;
deteteall &#39;sogou:search_detail&#39;, &#39;rowKey001&#39;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/hbase/">HBase</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>将已存在的代码提交到Github管理的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/git-add-code-to-exists-repo/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/git-add-code-to-exists-repo/</guid>
                <pubDate>Mon, 22 Jan 2018 14:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了如何将已存在的代码提交到Github管理。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、在github新建对应的仓库&lt;/p&gt;
&lt;p&gt;2、初始化本地目录为git目录并提交到github&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git add .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git commit -m &lt;span class=&#34;s2&#34;&gt;&amp;#34;Initial commit&amp;#34;&lt;/span&gt;​
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git remote add origin https://github.com/hunterzhang86/go-demo.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git push origin master​
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/git/">Git</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Guava中实现线程异步回调机制探索</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/guava-thread-listen/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/guava-thread-listen/</guid>
                <pubDate>Tue, 31 Oct 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;这几天有了解到Guava的LinsteningExecutorService可以设置线程执行完成后的回调方法, 联系到我们在进行多线程编程的时候都需要去拿到这个返回值做回调，所以很感兴趣Guava是怎实现这个机制的，遂调查了一下Guava的源码。本文介绍了Guava中LinsteningExecutorService的具体实现机制。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;Guava里面实现线程回调非常简单, 核心的逻辑就是新建一个Futures.CallbackListener的线程，这个线程会通过future.get阻塞拿到线程的返回值，拿到返回值之后就调用用户设置的onSuccess方法。&lt;/p&gt;
&lt;p&gt;如果在线程的执行过程中发生异常，则会调用用户设置的onFailure方法，将线程执行的异常信息返回给用户。&lt;/p&gt;
&lt;p&gt;核心逻辑的源代码如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;V&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getDone&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;future&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ExecutionException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;onFailure&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getCause&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RuntimeException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;onFailure&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;onSuccess&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/%E7%BA%BF%E7%A8%8B/">线程</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Java代码块的加载顺序总结</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-class-code-block-load-order/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/java-class-code-block-load-order/</guid>
                <pubDate>Tue, 31 Oct 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文对Java代码块的加载顺序进行了总结。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、父类【静态成员】和【静态代码块】，按在代码中出现的顺序依次执行;
2、子类【静态成员】和【静态代码块】，按在代码中出现的顺序依次执行;
3、父类【构造代码块】和【普通成员变量被普通成员方法赋值】，按在代码中出现的顺序依次执行;
4、子类【构造代码块】和【普通成员变量被普通成员方法赋值】，按在代码中出现的顺序依次执行;
5、执行子类的构造方法;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;说明&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;构造代码块: 直接在类中定义且没有加static关键字的代码块称为构造代码块;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/java/">Java</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>MAC上安装Telnet的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-brew-in-mac/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/install-brew-in-mac/</guid>
                <pubDate>Tue, 31 Oct 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了在MAC上安装Telnet的方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、安装brew：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ruby -e &amp;#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&amp;#34;  
中途会提示回车继续
Press RETURN to continue or any other key to abort
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2、安装telnet：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;brew install telnet
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>见贤思齐</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/learn-from-others/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/learn-from-others/</guid>
                <pubDate>Tue, 31 Oct 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;老板最近写了一封邮件寻找加西亚，这篇文章很火，上了很多网站的头条，看了老板的文章感觉这传说中的孔令贤是一个很牛的人，在2014年被连升过3级，所以在网上搜到了他的博客，没想到他当时的状态和我类似（当然，我距离他的水平有一定距离），都是内心惶恐，做了越来越多管理的活，每天忙于向领导汇报、揣摩领导心思，已经很难完全静下心来钻研技术了。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;我司现在导向其实非常鼓励大家技术转管理，带领大家走向成功，但当这种导向太过突出的时候，员工都已经将重心放到如何技术转管理上，真正的技术专家越来越少，软件的水平也就可想而知了。说白了就是指挥的人越来越多，干活的越来越少，真正写代码的大都是新员工、合作方兄弟。现在干脆连代码review都很少做了，遇到有责任心的兄弟还好，遇到那种责任心和技术都不太好的兄弟，代码简直不忍直视，说是小学生写得代码也不为过。所以在这种状况下，线上问题不断，兄弟们不断加班，然后最奇葩的事情是，真正做的质量好，可以早点下班的兄弟因为要陪着大家加班，最后也变得不注重代码质量，最后通通混指标了事。&lt;/p&gt;
&lt;p&gt;其实我很佩服孔令贤，因为他懂得自己真正想要什么，并付出行动去实现目标。公司破格给他提了三级，基本是坐上了火箭的状态，可以想象在我司会有很好的前途，但是依然能够走出舒适区，去追求真正自己喜欢的东西，非常的难能可贵。我虽然没有他那样的水平，但我也不想未来把自己变成一个只会每天扯皮，不断要求同事加班的领导。所以见贤思齐，趁着自己年纪还不大，争取在未来半年找到一个更有挑战性的岗位，实现自己更大的价值。&lt;/p&gt;
&lt;p&gt;最后，见贤思齐，希望自己也能够多写博客，利用github给的这么好的平台，把在公司写博客的热情拿出来，提高自己，也照亮他人。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>一种显示目录结构的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/show-dir/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/show-dir/</guid>
                <pubDate>Tue, 31 Oct 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文介绍了一种显示目录结构的方法。&lt;/p&gt;
&lt;!--more --&gt;
&lt;p&gt;1、windows下显示目录结构&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;tree /F
D:\Program Files\Hexo\source&amp;gt;tree /F
文件夹 PATH 列表
卷序列号为 00000200 E077:4672
D:.
│  CNAME
│
├─about
│      index.md
│
└─_posts
        config-hexo-in-windows.md
        learn-from-others.md
        show-dir.md
        think-more-ways-less-questions.md
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2、Linux下显示目录结构的方法&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;find . | sed -e &amp;#39;s;[^/]*/;|___;g;s;___|; |;g&amp;#39;
admin@admin-PC MINGW32 /d/Program Files/Hexo/source
$ find . | sed -e &amp;#39;s;[^/]*/;|___;g;s;___|; |;g&amp;#39;
.
|___about
| |___index.md
|___CNAME
|____posts
| |___config-hexo-in-windows.md
| |___learn-from-others.md
| |___show-dir.md
| |___think-more-ways-less-questions.md
&lt;/code&gt;&lt;/pre&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/linux/">Linux</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>配置 Kafka Exactly-Once 消费的方法</title>
                <link>https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/%E9%85%8D%E7%BD%AEkafka-exactly-once%E6%B6%88%E8%B4%B9%E7%9A%84%E6%96%B9%E6%B3%95/</link>
                <guid isPermaLink="true">https://blog.fflow.link/posts/%E5%BD%92%E6%A1%A3/%E9%85%8D%E7%BD%AEkafka-exactly-once%E6%B6%88%E8%B4%B9%E7%9A%84%E6%96%B9%E6%B3%95/</guid>
                <pubDate>Fri, 22 Sep 2017 20:38:17 &#43;0000</pubDate>
                
                    <author>hunterzhang86@gmail.com (fflow)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description>&lt;p&gt;本文主要介绍了如何在Kafka中如何配置使用消息刚好传递一次。&lt;/p&gt;
&lt;!--more --&gt;
&lt;h4 id=&#34;术语释疑&#34;&gt;术语释疑&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;at-least-once
至少传递一次，如果broker在收到消息后，发送ack之前失败，且生产者设置了重试，这种情况下可能会产生重复的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;at-most-once
最多传递一次，如果生产者在发送消息失败后没有设置重试，虽然不会产生重复数据，但有可能丢失数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;exactly-once
刚好传递一次，即使producer重试发送消息，消息也会保证最多一次地传递给最终consumer。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Producer配置&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;config&lt;/th&gt;
&lt;th&gt;current default value&lt;/th&gt;
&lt;th&gt;proposed default value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;enable.idempotence&lt;/td&gt;
&lt;td&gt;false&lt;/td&gt;
&lt;td&gt;true&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;acks&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;all&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;max.in.flight.requests.per.connection&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;retries&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;MAX_INT&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;其他的参数比较好理解，max.in.flight.requests.per.connection参数表示限制客户端在单个连接上能够同时发送的未响应请求的个数，是kafka为了提高吞吐量的一个参数。如果要实现Exactly-once语义，需要将值由默认的5设置成1, 主要是因为如果配置成 &amp;gt;= 2, kafka将不能保证消息的顺序，但是如果设置成1则对kafka的吞吐量有一定影响。&lt;/p&gt;
&lt;p&gt;Producer配置代码&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;initTransactions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;beginTransaction&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;send&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;send&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;commitTransaction&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProducerFencedException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;KafkaException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;producer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;abortTransaction&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Consumer配置&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;config&lt;/th&gt;
&lt;th&gt;current default value&lt;/th&gt;
&lt;th&gt;proposed default value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;isolation&lt;/td&gt;
&lt;td&gt;read_uhcommitted&lt;/td&gt;
&lt;td&gt;read_committed&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;enable.auto.commit&lt;/td&gt;
&lt;td&gt;true&lt;/td&gt;
&lt;td&gt;false&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Consumer示例代码&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;records&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;consumer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;poll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ConsumerRecord&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;records&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;consumer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;commitSync&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;commit语句放在process语句前面还是后面取决于业务，如果process已经实现了幂等性，可以将commit放在process后面，且可以在当前所有的records处理完成之后再一起commit；
而如果处理消息没有实现幂等性，且消息多处理一次可能会影响业务的功能(考虑极端情况，在处理的过程中jvm直接被杀掉了)，则建议将commit语句放在process语句前面；
如果极端情况下，有一条消息没有处理可能会对业务造成影响，则需要业务实现事务来持久化已经处理成功的offset，在消费者因为异常情况被杀掉再重启之后，消费者可以通过持久化的数据知道需要从哪一条消息开始处理。
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;参考文献&#34;&gt;参考文献&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cwiki.apache.org/confluence/display/KAFKA/KIP-185%3A+Make+exactly+once+in+order+delivery+per+partition+the+default+producer+setting&#34;&gt;Make exactly once in order delivery per partition the default producer setting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cwiki.apache.org/confluence/display/KAFKA/KIP-98+-+Exactly+Once+Delivery+and+Transactional+Messaging&#34;&gt;Exactly Once Delivery and Transactional Messaging&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/&#34;&gt;Exactly-once Semantics are Possible: Here’s How Kafka Does it&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">知识图谱</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://blog.fflow.link/tags/mq/">MQ</category>
                                
                            
                        
                    
                
            </item>
        
    </channel>
</rss>
